CloudEx: A Fair-Access Financial Exchange in the
Cloud
Ahmad Ghalayini Jinkun Geng Vighnesh Sachidananda
StanfordUniversity StanfordUniversity StanfordUniversity
Stanford,USA Stanford,USA Stanford,USA
Vinay Sriram Yilong Geng Balaji Prabhakar
TickTockNetworks TickTockNetworks StanfordUniversity
PaloAlto,USA PaloAlto,USA Stanford,USA
Mendel Rosenblum Anirudh Sivaraman
StanfordUniversity NYU
Stanford,USA NewYork,USA
ABSTRACT KEYWORDS
Financialexchangeshavebegunamovefromon-premise financialexchanges,fair-accessexchanges,high-frequency
andcustom-engineereddatacenterstothepubliccloud,ac- trading,low-latencysystems,clocksynchronization
celeratedbyarushofnewinvestors,theriseofremotework,
ACMReferenceFormat:
costsavingsfromthecloud,andthedesireformoreresilient
AhmadGhalayini,JinkunGeng,VighneshSachidananda,VinaySri-
infrastructure.Whilethepromiseofthecloudisenticing,
ram,YilongGeng,BalajiPrabhakar,MendelRosenblum,andAnirudh
the cloud‚Äôs varying network latencies can lead to market Sivaraman.2021.CloudEx:AFair-AccessFinancialExchangein
unfairness: orders can be processed out of sequence, and theCloud.InWorkshoponHotTopicsinOperatingSystems(HotOS
marketdatacanbedisseminatedtomarketparticipantsat ‚Äô21),May31‚ÄìJune2,2021,AnnArbor,MI,USA.ACM,NewYork,NY,
incorrecttimesduetovaryinglatenciesbetweenparticipants USA,8pages.https://doi.org/10.1145/3458336.3465278
andtheexchange.WepresentCloudEx,afair-accesscloud
exchange, which leverages high-precision software clock 1 INTRODUCTION
synchronization to compensate for noisy network condi-
Equity markets provide financial services to hundreds of
tionsinthepubliccloud.Wealsodiscussrefinementstothe
millionsofmarketparticipantsglobally[5,6].In2020alone,
CloudExdesignthatwereinformedbylessonslearnedfrom
thesemarketsadded10millionnewparticipants[13].Atthe
deployingCloudExintwoacademiccoursesandconclude
heartofthesemarketsareelectronicstockexchangessuch
byoutliningfutureresearchdirections.
asNASDAQandNYSE.
These exchanges are required by regulation to provide
CCSCONCEPTS marketparticipantswithfairaccesstothemarket[41].Fair
‚Ä¢Networks‚ÜíCloudcomputing;‚Ä¢Computersystems accesshastwoaspects.First,whentheexchangeprocesses
organization‚ÜíReal-timesystems;‚Ä¢Appliedcomputing incoming orders from participants, it must execute them
‚ÜíOnlineauctions. in the same sequence in which participants issued them.
Second,whentheexchangedisseminatesmarketdata(e.g.,
stockquotes)toparticipants,itmustdososimultaneously
Permissiontomakedigitalorhardcopiesofallorpartofthisworkfor sothatnoparticipanthasearlieraccesstomarketdata[25,
personalorclassroomuseisgrantedwithoutfeeprovidedthatcopies 32,33,39,42].Beyondregulation,marketparticipantswith
arenotmadeordistributedforprofitorcommercialadvantageandthat
lowerlatencycanexploitshort-livedmispricinginfinancial
copiesbearthisnoticeandthefullcitationonthefirstpage.Copyrights
assets.Economistsestimatethatabout5billiondollarsareat
forcomponentsofthisworkownedbyothersthantheauthor(s)must
behonored.Abstractingwithcreditispermitted.Tocopyotherwise,or stakeannuallyfromsuchlatencyarbitrageinglobalequity
republish,topostonserversortoredistributetolists,requirespriorspecific markets[20].
permissionand/orafee.Requestpermissionsfrompermissions@acm.org. Today‚Äôsexchangesuseon-premiseinfrastructurethatis
HotOS‚Äô21,May31‚ÄìJune2,2021,AnnArbor,MI,USA
heavilyengineeredtomeetfair-accessrequirements.Forin-
¬©2021Copyrightheldbytheowner/author(s).Publicationrightslicensed
stance,marketparticipantsareco-locatedinthesamephysi-
toACM.
calfacilityastheexchange.Further,theyareconnectedto
ACMISBN978-1-4503-8438-4/21/05.
https://doi.org/10.1145/3458336.3465278 theexchangethroughcableswhoselengthsareequalized
96

HotOS‚Äô21,May31‚ÄìJune2,2021,AnnArbor,MI,USA Ghalayini,etal.
acrossparticipants[2].Thisensuresthatparticipantorders
(cid:3)(cid:22)(cid:25)(cid:31)(cid:15)(cid:1)(cid:12)(cid:30)(cid:25)(cid:28)(cid:13)(cid:18)(cid:16) (cid:1)(cid:9)(cid:11)(cid:3)(cid:8)(cid:15)(cid:2)(cid:13)(cid:10)(cid:3)(cid:6)(cid:12)(cid:11)(cid:10)(cid:7)(cid:14)(cid:5)(cid:4)
donotovertakeeachotherduringorderprocessingandthat
ma
R
r
e
k
c
e
e
t
n
d
t
a
ly
ta
,
a
e
r
x
r
c
i
h
ve
a
s
ng
a
e
t
s
pa
h
r
a
ti
v
c
e
ip
b
a
e
n
e
t
n
sn
c
e
o
a
n
r
t
ly
em
si
p
m
la
u
t
l
i
t
n
a
g
ne
m
ou
o
s
v
l
i
y
n
.
g (cid:10)(cid:13)(cid:28)(cid:30)(cid:20)(cid:14)(cid:20)(cid:26)(cid:13)(cid:24)(cid:30)(cid:1)(cid:10)(cid:40)(cid:36)(cid:40)
(cid:5)(cid:13)(cid:30)
(cid:9)
(cid:16)
(cid:28)
(cid:33)
(cid:15)(cid:16)
(cid:13)
(cid:28)
(cid:35)(cid:1)(cid:5)(cid:40) (cid:3)(cid:16)(cid:24)(cid:30)(cid:28)(cid:13)(cid:22)(cid:1)(cid:4)(cid:34)(cid:14)(cid:19)(cid:13)(cid:24)(cid:18)(cid:16)(cid:1)(cid:12)(cid:16)(cid:28)(cid:32)(cid:16)(cid:28) (cid:5)(cid:42)
(cid:38)(cid:10)(cid:42)(cid:39)
(cid:6)(cid:13)(cid:24)(cid:15)(cid:22)(cid:16)(cid:28)
theiron-premiseinfrastructuretothecloud.Thismovehas
(cid:10)(cid:13)(cid:28)(cid:30)(cid:20)(cid:14)(cid:20)(cid:26)(cid:13)(cid:24)(cid:30)(cid:1)(cid:10)(cid:40)(cid:36)(cid:41)
beenmotivatedbytherapidincreaseinthenumberofpar-
(cid:10)(cid:13)(cid:28)(cid:30)(cid:20)(cid:14)(cid:20)(cid:26)(cid:13)(cid:24)(cid:30)(cid:1)(cid:10)(cid:40)(cid:36)(cid:42) (cid:6)(cid:37)(cid:11)(cid:1)(cid:2)(cid:31)(cid:17)(cid:17)(cid:16)(cid:28) (cid:12)(cid:16)(cid:27)(cid:31)(cid:16)(cid:24)(cid:14)(cid:16)(cid:28) (cid:5)(cid:43)
(cid:38)(cid:10)(cid:43)(cid:39)
ticipants,loweroutagesinthecloud,andcostsavingsfrom (cid:8)(cid:13)(cid:30)(cid:14)(cid:19)(cid:20)(cid:24)(cid:18)(cid:1)(cid:4)(cid:24)(cid:18)(cid:20)(cid:24)(cid:16)
movingtothecloud[11].Theriseofremoteworkduetothe (cid:10)(cid:25)(cid:28)(cid:30)(cid:17)(cid:25)(cid:22)(cid:20)(cid:25)(cid:1)(cid:8)(cid:13)(cid:30)(cid:28)(cid:20)(cid:34)
COVID-19pandemichasalsoaddedurgencytothiscloud (cid:10)(cid:13)(cid:28)(cid:30)(cid:20)(cid:14)(cid:20)(cid:26)(cid:13)(cid:24)(cid:30)(cid:29)(cid:1)(cid:38)(cid:10)(cid:41)(cid:39)
(cid:5)(cid:13)(cid:30)(cid:16)(cid:33)(cid:13)(cid:35)(cid:1)(cid:5)(cid:41)
(cid:7)(cid:20)(cid:23)(cid:20)(cid:30)(cid:1)(cid:9)(cid:28)(cid:15)(cid:16)(cid:28)(cid:1)(cid:2)(cid:25)(cid:25)(cid:21)(cid:29)
(cid:5)(cid:44)
(cid:38)(cid:10)(cid:44)(cid:39)
migration[11,34].Forinstance,NASDAQplanstomigrate
all markets to the public cloud in the next decade [9, 11] Figure1:SystemArchitectureofCloudEx
and has already started offloading data processing to the
We conduct a preliminary evaluation of CloudEx in ¬ß4.
cloud[12].
OurkeytakeawayfrombuildingCloudExisthatitispossible
Whilemigratingexchangestothepubliccloudhassev-
tobuildafair-accessstockexchangeinthecloud.However,
eralbenefits,thebest-effortnatureofthecloudalsoposes
CloudExhasnotyetbeenoptimizedforperformanceand
challengestomeetingfair-accessrequirements.Forinstance,
itscurrentthroughputandlatency(Table1)fallshortofon-
incontrasttothedeterministicexchange-participantlaten- premiseexchanges(60‚Äì100Korders/secondonaverage1and
cies provided by carefully engineering network paths in ‚àº60¬µs[10,Page21]).Wediscussongoingoptimizationsto
on-premiseexchanges,exchange-participantlatenciesinthe
improveCloudEx‚Äôsperformance(¬ß6)andoutlineotherareas
cloudcanvaryunpredictablyovertime.Thisvariationin
forfuturework(¬ß7).
networklatenciescausesunfairness:itallowssomepartic-
ipants‚Äôorderstoovertakeothersenroutetotheexchange 2 DESIGN
andallowsmarketdatatoreachsomeparticipantsearlier
2.1 SystemArchitecture
thanothers.
Tounderstandthetechnicalchallengesofbuildingafair- CloudExconsistsofmarketparticipants,gateways,acentral
accessfinancialexchangeinthecloud,incollaborationwith exchangeserver,andcloudstorage.Fig.1summarizesthe
amajorstockexchange,wearebuildingCloudEx‚Äîtoour CloudEx architecture. Fig. 2 illustrates the lifecycle of an
knowledge,thefirstdemonstrationofafair-accessexchange orderinCloudEx.WeuseZeroMQ[17]forreliablenetwork
in the cloud. We have so far evaluated CloudEx in realis- communication between the different components. Each
ticsettingsusingstudentparticipantsintwocourses.The gateway clock is precisely synchronized to the reference
learningsfrombothcourseshavehelpedusfurtherrefine clockatthecentralexchangeserver.
CloudExforreal-worlduse. Market Participants. Each market participant owns a VM
CloudEx currently incorporates three main ideas. First, thatisconnectedtooneofthegateways.Theparticipants
it uses high precision (nanosecond-level) software-based areprovidedAPIsthatallowthemto(1)submitordersand
clocksynchronization[30]tomeasurevariableVM-to-VM receiveorderandtradeconfirmations,(2)subscribetoreal-
latenciesinthecloud.Variablemessagelatenciescanbecom- timemarketdatastreams,and(3)queryforhistoricalmarket
pensatedbydelayingmessagesarrivingearlierbyacertain datafromalong-termcloudstoragemodule.Toplaceanor-
timeùëë toensurefairness(¬ß2). der,aparticipantconstructsanordermessageandforwards
Second, in our course deployment of CloudEx, we ob- ittotheparticipant‚Äôsassignedgateway.Anordermessage
servedthatnetworklatenciesinthecloudchangeovertime containsthesymboltobetraded(e.g.,astockorfuturecon-
and with the number of participants. Thus, a fixedùëë will tract),theaction(buyorsell),thenumberofshares,theorder
resulteitherinhigher-than-neededlatenciesorunfairnessat type(e.g.,limitorder[14]ormarketorder[15]),andthelimit
somepoint.Hence,wedevelopedacontrolstrategytotune priceforlimitorders.
ùëë toachieveatargetunfairnessratio,regardlessofchanging Gateways.Thegatewayssitbetweenthemarketparticipants
cloudconditions(¬ß3). andthecentralexchangeserver,routingorderstothecentral
Third,inourcoursedeployment,wealsoobservedhigh exchangeserverandroutingmarketdatatotheparticipants
ordersubmissionlatenciesbecauseofsloworfailedgateways [20]. Gateways are also required to secure the matching
thatconnectparticipantstotheexchange.Forfaulttolerance enginefromabuse,e.g.,unauthenticatedorinvalidorders.
andtoreducelatency,especiallyatthetail,ordersinCloudEx Eachgatewayhoststwomodules:anorderhandleranda
arereplicatedandroutedtotheexchangethroughmultiple hold/release(H/R)buffer.Theorderhandlerauthenticates
gatewayVMs.Thisallowstheexchangetopicktheearliest
arrivingorder(¬ß3). 1Basedonourconversationswithexchangeoperators.
97

CloudEx:AFair-AccessFinancialExchangeintheCloud HotOS‚Äô21,May31‚ÄìJune2,2021,AnnArbor,MI,USA
(cid:5)(cid:12)(cid:24)(cid:15)(cid:27)(cid:12)(cid:29) (cid:3)(cid:15)(cid:21)(cid:24)(cid:23)(cid:12)(cid:20)(cid:1)(cid:4)(cid:28)(cid:13)(cid:18)(cid:12)(cid:21)(cid:17)(cid:15)(cid:1)(cid:10)(cid:15)(cid:23)(cid:26)(cid:15)(cid:23)
(cid:11)(cid:23)(cid:12)(cid:14)(cid:15)(cid:23) (cid:8)(cid:23)(cid:14)(cid:15)(cid:23)(cid:1) (cid:6)(cid:30)(cid:9) (cid:7)(cid:12)(cid:24)(cid:13)(cid:18)(cid:19)(cid:21)(cid:17)(cid:1)
(cid:10)(cid:15)(cid:22)(cid:25)(cid:15)(cid:21)(cid:13)(cid:15)(cid:23)
(cid:6)(cid:12)(cid:21)(cid:14)(cid:20)(cid:15)(cid:23) (cid:2)(cid:25)(cid:16)(cid:16)(cid:15)(cid:23) (cid:4)(cid:21)(cid:17)(cid:19)(cid:21)(cid:15)
(cid:26)(cid:24)(cid:1)(cid:6)(cid:22)(cid:9)(cid:15)(cid:13)(cid:21)(cid:1)(cid:4)(cid:19)(cid:10)(cid:11)(cid:19)
(cid:27)(cid:24)(cid:1)(cid:3)(cid:17)(cid:19)(cid:23)(cid:8)(cid:19)(cid:10)(cid:1)(cid:7)(cid:13)(cid:15)(cid:11)(cid:20)(cid:21)(cid:8)(cid:15)(cid:18)(cid:11)(cid:10)(cid:1)(cid:4)(cid:19)(cid:10)(cid:11)(cid:19)
(cid:28)(cid:24)(cid:1)(cid:5)(cid:11)(cid:14)(cid:11)(cid:8)(cid:20)(cid:11)(cid:1)(cid:4)(cid:19)(cid:10)(cid:11)(cid:19)
(cid:29)(cid:24)(cid:1)(cid:6)(cid:11)(cid:16)(cid:10)(cid:1)(cid:2)(cid:17)(cid:16)(cid:12)(cid:13)(cid:19)(cid:15)(cid:8)(cid:21)(cid:13)(cid:17)(cid:16)(cid:1)(cid:17)(cid:12)(cid:1)(cid:4)(cid:19)(cid:10)(cid:11)(cid:19)
(cid:30)(cid:24)(cid:1)(cid:3)(cid:17)(cid:19)(cid:23)(cid:8)(cid:19)(cid:10)(cid:1)(cid:4)(cid:19)(cid:10)(cid:11)(cid:19)(cid:1)
(cid:2)(cid:17)(cid:16)(cid:12)(cid:13)(cid:19)(cid:15)(cid:8)(cid:21)(cid:13)(cid:17)(cid:16) (cid:31)(cid:24)(cid:1)(cid:6)(cid:11)(cid:16)(cid:10)(cid:1)(cid:2)(cid:17)(cid:16)(cid:12)(cid:13)(cid:19)(cid:15)(cid:8)(cid:21)(cid:13)(cid:17)(cid:16)(cid:1)(cid:17)(cid:12)(cid:1)(cid:7)(cid:19)(cid:8)(cid:10)(cid:11)
(cid:32)(cid:24)(cid:1)(cid:5)(cid:11)(cid:14)(cid:11)(cid:8)(cid:20)(cid:11)(cid:1)(cid:7)(cid:19)(cid:8)(cid:10)(cid:11)(cid:1)(cid:2)(cid:17)(cid:16)(cid:12)(cid:13)(cid:19)(cid:15)(cid:8)(cid:21)(cid:13)(cid:17)(cid:16)
Figure2:LifecycleofanOrderinCloudEx
(cid:14)(cid:23)(cid:21)(cid:1)(cid:17)(cid:23)(cid:21)(cid:22) (cid:13)(cid:30)(cid:24)(cid:1)(cid:17)(cid:23)(cid:21)(cid:22)
(cid:2)(cid:9) (cid:2)(cid:10) (cid:2)(cid:11) (cid:2)(cid:5)(cid:7) (cid:2)(cid:5)(cid:8)(cid:2)(cid:5)(cid:9)(cid:2)(cid:5)(cid:12)(cid:2)(cid:6)(cid:4)
(cid:22)(cid:26)(cid:32)(cid:25)(cid:27)(cid:18)
equaltothelowestask(respectively,highestbid)intheorder
book.Incominglimitordersthatcannotbematchedonar-
rivalareaddedtothebook.Ifmultipleincominglimitorders
atthesamepricearematchedagainstabid/askinthelimit
order book, ties are broken based on the orders‚Äô gateway
timestamps,withprioritygiventotheearliertimestamps.
After each order is processed, an order confirmation is
generatedandsenttotheappropriategateway‚Äôsorderhan-
dler(Fig.2).Whenatradeisexecuted,theportfoliomatrix
is updated, and a record of the trade is generated. Trade
recordsconsistofthetradedsymbol,thenumberofshares
traded,andtheexecutionprice,andarepersistedinGoogle
Bigtable [26]. Market participants are provided an API to
queryhistoricalmarketdatafromBigtable.
(cid:14)(cid:23)(cid:21)(cid:3)(cid:13)(cid:30)(cid:24)(cid:1) MarketDataDissemination.Thefinalfunctionofthematch-
(cid:17)(cid:28)(cid:29)(cid:22)(cid:19)(cid:21)
ing engine is to provide real-time market data streams to
theparticipantsviatheH/Rbuffersatthegateways.Mar-
ketdataincludesbothtraderecordsandperiodicsnapshots
(cid:15)(cid:23)(cid:26)(cid:23)(cid:31)(cid:1)(cid:16)(cid:29)(cid:23)(cid:20)(cid:22)
ofthelimitorderbooks.Marketparticipantssubscribeto
Figure3:VisualizationofaLimitOrderBook thisdatapersymbol.Beforetraderecordsandlimitorder
booksnapshotsareforwardedtothegateways,thematching
andvalidatesordersreceivedfromtheparticipants,andthen
engineassignsareleasetimestampthatspecifieswhenthe
assignsagloballysynchronizedtimestamptotheseorders
beforeforwardingthemtothecentralexchangeserver.2The gatewaysoughttodispenseeachpieceofmarketdatatothe
participants(Fig.2).
orderhandlerisalsoresponsibleforroutingorderconfirma-
tionsreceivedfromthecentralexchangeserverbacktothe
2.2 Unfairness:DefinitionsandRemedies
participants(Fig.2).Meanwhile,real-timemarketdatare-
ceivedfromthecentralexchangeserverisdispensedtoeach Inpractice,itisimpossibletobuildaperfectlyfairexchange
participantviatheH/Rbuffers.EachH/Rbufferholdsagiven because of the variable delays from the gateways to the
pieceofdatauntiltheprescribedreleasetimeforthatpiece matchingengine.Wequantifyhowunfairanexchangeis
ofdata.Assumingmarketdataarrivesearlyenough,precise through(1)aninboundunfairnessratioand(2)anoutbound
clocksynchronizationandidenticalreleasetimesguarantee unfairnessratio.Inanidealexchange,bothshouldbezero.
thatmarketdataissimultaneouslysenttoallparticipants. Toremedyeachsourceofunfairness,weintroduceacom-
Sequencer.Thesequencerreceivesinboundordersfromthe pensatingdelayparameter.Weexplaintheunfairnessratios
gateways and enqueues each order into a priority queue anddelayparametersbelow.
basedontheorder‚Äôsgateway-assignedtimestamp. InboundUnfairnessRatio.Inboundunfairnessratioisde-
Matching Engine. The matching engine dequeues orders finedasthepercentageoftotalordersthatareprocessedout
from the sequencer and runs the ‚Äúcontinuous price-time ofsequence.Anorderisconsideredtobeprocessedoutof
matching‚Äùalgorithm[8],usedbymostexchanges.Theal- sequence when its gateway-assigned timestamp is earlier
gorithm maintains two data structures: limit order books thanthatoftheprecedingprocessed order.
(Fig. 3) that store unmatched limit orders, and a portfolio OutboundUnfairnessRatio.Outboundunfairnessratiois
matrixthattrackseachmarketparticipant‚Äôsassetsandcash definedasthepercentageoftotalpiecesofmarketdatathat
balance.Thelimitorderbookforeachsymbolstoresthebids areunfairlydisseminated.Apieceofmarketdataisconsid-
(buyorders)andasks(sellorders)forthatsymbol.Thebids eredtobeunfairlydisseminatedifoneormoregateways
aresortedinorderofdecreasinglimitprice,andtheasks receiveitlaterthanthedata‚Äôsdesignatedreleasetime.
sortedinorderofincreasinglimitprice.Amatch,whichpro- SequencerDelayParameter,ùëë ùë†.Toaddressinbound(order)
ducesoneormoretrades,happenswheneitheranincoming unfairness, the sequencing buffer is instructed to hold or-
bid(ask)specifiesapricegreater(respectively,less)thanor dersuntiladelayùëë ùë† haselapsedrelativetotheirgateway
timestamps.Inotherwords,thesequencerdequeuesanor-
2OrdertimestampsaretakenatgatewayVMsinsteadoftheparticipant
derùëÇ ifandonlyifùë° ùê∂ ‚àíùë° ùëÇ ‚â• ùëë ùë†,whereùë° ùê∂ representsthe
VMsforsecurity:gatewayVMsareownedandmanagedbytheexchange
operator,unlikeparticipantVMs.Thetimestampscouldalsobetakenina currenttimeandùë° ùëÇ representsthegatewaytimestampof
secureenclave[7]withinparticipantVMs. the order. This delay provides orders submitted beforeùëÇ
98

HotOS‚Äô21,May31‚ÄìJune2,2021,AnnArbor,MI,USA Ghalayini,etal.
sufficienttimetoarriveatthecentralexchangeserverand Sharding.Weshardthematchingenginebasedonsymbols,
beproperlysequencedbythepriorityqueuebeforeorderùëÇ witheachsharddequeuingordersfromitsownorderprior-
itselfisdequeued. ityqueueandmanagingthelimitorderbooksofasubset
Hold/Release Buffer Delay Parameter,ùëë ‚Ñé. To address out- ofsymbols.Basedonitssymbol,anorderisroutedtothe
bound(marketdata)unfairness,weusehold/releasebuffers. correspondingshard.
ConsiderapieceofmarketdataùëÄ,andletùë° ùëÄ representits DynamicDelayParameters(DDP).Empirically,inourde-
creationtimeatthematchingengine.Thehold/releasebuffer ployments, we observed that there is no simple relation-
ateachgatewayisinstructedtoreleaseùëÄ attimeùë° ùëÖ,where shipbetweentheunfairnessratiosandthedelayparameters
ùë° ùëÖ = ùë° ùëÄ +ùëë ‚Ñé.ùëë ‚Ñé isthemaximumtimethatapieceofmar- (Figs.4and5furtherillustratethis).Hence,wecannoteasily
ketdatahastowaitinthehold/releasebufferbeforeitcan deriveanddirectlycontroltheunfairnessratiobysettingthe
bereleasedtothemarketparticipants.Thisdelayprovides delayparametertoastaticvalue.Further,time-varyingla-
allgatewaysenoughtimetoreceiveùëÄ fromthematching tenciesinthecloudnecessitatethattheseparametersshould
enginebeforeùëÄ‚Äôsreleasetime. beupdatedcontinuouslytoachieveatargetunfairnessratio.
Consequencesofùëë ùë† andùëë ‚Ñé.Thevaluesofùëë ùë† andùëë ‚Ñé control To directly control the unfairness ratio, CloudEx continu-
thelatency-fairnesstrade-off(Fig.4)inCloudEx.Largedelay ously and independently tunes each delay parameter. For
parametervaluescausethesystemtobecomelessresponsive eachparameter,DDPusesarollingwindowoforder/market
tomarketparticipantsduetolargerlatencies,whilesmall datasamples(ofsize1000samples/window)tocalculatethe
valuesmakethesystemlessfair. unfairnessratiosinrealtime.Ifthecurrentunfairnessratio
isabovethetargetunfairnessratio,DDPincreasesthedelay
parameterbyasmallfixedamount(5¬µs),elseDDPdecreases
itbythesameamount.
ReplicatedOrderSubmission(ROS).VMsarenothomoge-
3 COURSEDEPLOYMENTSAND neousandstragglersarecommoninthecloud[27].When
REFINEMENTS marketparticipantssubmitorderstoaslowgateway,they
sufferfromalongdelaybeforereceivinganorderconfirma-
TounderstandthechallengesofoperatingCloudEx,wede-
tion.Evenworse,ifagatewaycrashes,thecorresponding
ployeditintwocoursesusingstudentsasparticipants.We
participantswillnotbeabletosubmitanyordersuntilthat
discusslearningsfromthesedeploymentsandhowwere-
gateway restarts. To address such stragglers and achieve
finedCloudExbasedonthem.
faulttolerance,weusemessagereplicationbylettingmarket
Deployment Setup. For our first deployment, we held a 3-
participantssubmitreplicasofthesameorderthroughmul-
hourtradingcompetitionbetween13tradinggroupsofhigh
tiplegatewaysinsteadofonegateway.Thematchingengine
schoolstudentsaspartofasummercourse.Overthiscompe-
processestheearliest-arrivingreplicaanddropstheothers.
tition,studentsplacedroughly1000ordersand1000trades
across 10 symbols. For each symbol we initiated trading
botstoplacetradestoinducespecificprice-timepatternson
whichstudentscouldengineeralgorithms.Foroursecond,
larger,deployment,wedeployedCloudExinafinancialtech-
4 EVALUATION
nologiesandalgorithmscourseattendedbyundergraduate,
masters,andPhDstudents.Over8tradingdays,32groups Testbed.TobenchmarkCloudExandevaluatetheeffective-
ofstudentsplaced4.2millionordersand330000trades. nessofDDPandROS,welauncha65-nodeGoogleCloud
cluster,including48marketparticipantVMsoftype
LearningsfromDeployments.Ourfirstdeploymentledto
n1-highmem-2,16gatewayVMsoftypen1-highmem-8and
changesinourAPIstomakeCloudExmoreuser-friendly.It
1 matching engine VM of type n1-standard-64 [18]. All
alsoledustotheobservationthatwecouldsupportmore
VMsaredeployedwithinthesamezone(us-central1-a).
symbolsinCloudExbyshardingthematchingengineover
symbols.Inourseconddeployment,weobservedthatwitha TradingSetup.Theexchangehas100symbolsfortrading.
fixeddelayparameter,theunfairnessratiosvarieddailydue For¬ß4.2,thematchingenginehasoneshard,andeachmarket
tochangingcloudnetworkconditions.Thisledustodevelop participant submits around 450 orders/s on average (22K
acontrolscheme(DDP)totunedelayparametersautomati- ordersintotalprocessedbythematchingenginepersecond),
callybasedonsensednetworkconditions.Wealsoobserved foratotaldurationof5minutesperexperiment.
thatstragglerandfaultygatewayscaninflatelatency,leading ClockSynchronization.TheVMclocksaresynchronizedus-
ustoascheme(ROS)toreplicateordersthroughmultiple ing the Huygens algorithm [30]. During a sample 3-hour
gatewaysforlowerlatencyandfaulttolerance. runinourtestbed,the99thpercentileclockoffsetsaverage
99

CloudEx:AFair-AccessFinancialExchangeintheCloud HotOS‚Äô21,May31‚ÄìJune2,2021,AnnArbor,MI,USA
around159ns.3Toillustratethebenefitsofsynchronization, byperiodicallyinjecting0,400and200¬µsofdelaystothe
we first run CloudEx without the inbound resequencing gateway-enginelinkevery6seconds(Fig.5).
mechanism. The inbound unfairness ratio is 24.6%. With Fig.4indicatesthattheDDPstrategy(showninred)offers
clocksynchronization,evenastaticùëë ùë† of0achievesanin- directcontrol,allowingexchangeoperatorscontroloverthe
boundunfairnessratioof8.4%. level of fairness for market participants. As shown in the
figure,allexperimentswithDDPyieldunfairnessratiosthat
4.1 ThroughputandLatency are very close to the target ratios. By contrast, sweeping
Webenchmarkedourmatchingenginebyvaryingthenum- staticdelayparameters(showninblue)achievesapoorer
ber of shards; throughput and median latency results are trade-off,becauseunfairnessratiosanddelayparametersare
summarizedinTable1.Afterreaching8shards,thethrough- notsimplyrelated.Forexample,insomecases,asmallreduc-
putstopsimprovingsincedifferentshardsneedtoserialize tionofthedelayparameter(e.g.,from400¬µsto200¬µsforthe
theirupdatestoshareddatastructures(e.g.,portfolios). inbounddirection)mayleadtoaworseunfairnessratioby
morethanoneorderofmagnitude.Inothercases,alargein-
Table 1: CloudEx Throughput and Median La-
crease(e.g.,from400¬µsto1000¬µsfortheinbounddirection)
tencyasaFunctionofNumberofShards
offerslittlereductionintheunfairnessratio,illustratingthe
Submission End-to-End difficultyofdirectlysettingdelayparameters.
Shards Throughput
Latency(¬µs)1 Latency(¬µs)2
Fig.5indicatesthatDDPadaptstothetime-varyingen-
1 22k 365 1128 vironment,andachievesabettertrade-offbetweenfairness
2 40k 402 1089 andqueuing/releasingdelay.Inotherwords,withsimilarin-
4 49k 401 1094 bound/outboundunfairnessratio,DDPachieveslowerqueu-
8 61k 390 1080 ing/releasingdelaythanthestaticcounterparts.
16 61k 395 1044
ROSEvaluation.InFig.6a,weshowthechangeofthesub-
1 Thesubmissionlatencyisthelatencyfromwhentheparticipant missionlatencyasthereplicationfactor(RF)increases.Com-
submitstheordertowhenthematchingenginereceivesthe paring the single submission (RF = 1) with the replicated
order.
submission(RF=3),wecanseethatthemedianlatencyis
2 Theend-to-endlatencyisthelatencyfromwhentheparticipant
reducedby15%(365¬µsto309¬µs),andthe99.9th percentile
submitstheordertowhenitreceivestheorderconfirmation
fromthematchingengine. latencyisreducedby40%(1096¬µsto658¬µs).However,in-
creasingtheRFalsoincreasesCPUusage(Fig.6b).When
4.2 EvaluationofDDPandROS
theRFexceeds3,latencydegradesduetotheCPUspending
DDPEvaluation.Figs.4and5demonstratetheadvantages moretimeindiscardingduplicates.
oftheDDPstrategyoverstaticdelayparametersofdifferent
valuesfrom400‚àí1200¬µs.DDPenjoystwomajorbenefits.
(1)Directcontroloverunfairnessratios:Insteadofsettingade-
laythresholdthathasacomplexrelationshipwithunfairness 5 RELATEDWORK
ratio,wecansetatargetunfairnessratio.Then,DDPcan
AlgorithmicallyTacklingUnfairness.Complementaryto
automaticallytunedelayparameterstomeetthistarget.This
CloudEx‚Äôsgoalofreducinglatencyvariability,severalpro-
makestheunfairnessratiomorepredictable.(2)Adaptability:
posalstackleunfairnessduetolatencyvariabilitybychang-
Whenthemessagedelayvariesduringruntime,DDPdynam-
ingthematchingengine‚Äôsalgorithmitself.Forinstance,some
icallytunesthedelayvaluetoguaranteeafairnesstarget,
order-matchingalgorithmsgiveequal[25]orrandom[36]
withoutsacrificingtoomuchqueuing/releasingdelay.4
matchingprioritytoordersarrivingwithinacertaintime
Weevaluatetwoscenariostoproveeachbenefit.Inthe
range‚ÄîinsteadofthestrictFCFSorderrequiredbycontinu-
firstscenario,wesimplyrunCloudExwithoutartificialde-
ousprice-timematching[8].
lays,toproveDDPcancontroltheunfairnessratioaccording
OnlineMultiplayerGames.Multiplayeronlinegamingser-
to different targets (Fig. 4). For the second one, to exam-
vers,likeCloudEx‚Äôsexchangeservers,ideallyprocessplayers‚Äô
inetheadaptabilityofDDP,wesimulatevariablelatencies
actions in the order in which players executed them, and
3WhenwetriedCloudExwithNTP[37],thestandardinsoftwareclock publishgamestateupdatestoalltheplayerssimultaneously.
synchronization,wefound~10msclockoffsetsbetweengateways.Theseoff- Sync-MS[35]similarlyusessynchronizedtimestampsfor
setsaremuchlargerthanCloudEx‚Äôsgateway-to-matching-enginelatencies, fairness,butisevaluatedinsimulationinsteadofinthecloud.
makingNTPunsuitableforCloudEx.
Moreover,timescalesinthegamingcontext(milliseconds)
4Queuingdelayisthetimebetweentheenqueueandthedequeueofan
are an order of magnitude larger than those in financial
orderatthesequencer.Releasingdelayisthetimebetweentheholdand
thereleaseofonepieceofmarketdataattheH/Rbuffer.
exchanges(‚àº100¬µs).
100

HotOS‚Äô21,May31‚ÄìJune2,2021,AnnArbor,MI,USA Ghalayini,etal.
(cid:33)(cid:32)(cid:32)(cid:32) (cid:41)(cid:32)(cid:32) (cid:2)(cid:6)(cid:10)(cid:9)(cid:9)(cid:9)(cid:4)(cid:3) (cid:40)(cid:32)(cid:32) (cid:2)(cid:6)(cid:17)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:39)(cid:32)(cid:32) (cid:2)(cid:6)(cid:16)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:38)(cid:32)(cid:32) (cid:2)(cid:6)(cid:15)(cid:9)(cid:9)(cid:4)(cid:3) (cid:37)(cid:32)(cid:32) (cid:2)(cid:6)(cid:14)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:36)(cid:32)(cid:32) (cid:2)(cid:6)(cid:13)(cid:9)(cid:9)(cid:4)(cid:3) (cid:35)(cid:32)(cid:32) (cid:34)(cid:32)(cid:1)(cid:32)(cid:6)(cid:9)(cid:5)(cid:14)(cid:20) (cid:1)(cid:6)(cid:10)(cid:20) (cid:2)(cid:6)(cid:11)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:33)(cid:32)(cid:32)
(cid:32) (cid:1)(cid:6)(cid:11)(cid:20) (cid:1)(cid:6)(cid:12)(cid:20) (cid:1)(cid:6)(cid:13)(cid:20) (cid:1)(cid:6)(cid:14)(cid:20)
(cid:32) (cid:33) (cid:34) (cid:35) (cid:36) (cid:37) (cid:38) (cid:39) (cid:40)
(cid:29)(cid:22)(cid:27)(cid:28)(cid:26)(cid:9)(cid:17)(cid:13)(cid:4)(cid:15)(cid:19)(cid:16)(cid:24)(cid:13)(cid:24)(cid:6)(cid:13)(cid:15)(cid:9)(cid:21)(cid:13)(cid:25)(cid:2) (cid:3)(cid:13)(cid:23)(cid:23)(cid:13)(cid:21) (cid:7)(cid:23)(cid:9)(cid:23)(cid:16)(cid:11) (cid:4)(cid:26)(cid:19)(cid:9)(cid:18)(cid:16)(cid:11)
(cid:5)(cid:19)(cid:10)(cid:20)(cid:24)(cid:19)(cid:12)(cid:1)(cid:8)(cid:19)(cid:14)(cid:9)(cid:16)(cid:21)(cid:19)(cid:13)(cid:22)(cid:22)(cid:28)(cid:44)(cid:29)
(cid:3)(cid:13)(cid:23)(cid:23)(cid:13)(cid:21) (cid:33)(cid:32)(cid:32)(cid:32) (cid:2)(cid:6)(cid:10)(cid:11)(cid:9)(cid:9)(cid:4)(cid:3) (cid:41)(cid:32)(cid:32) (cid:2)(cid:6)(cid:10)(cid:9)(cid:9)(cid:9)(cid:4)(cid:3) (cid:40)(cid:32)(cid:32)
(cid:2)(cid:6)(cid:17)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:39)(cid:32)(cid:32)
(cid:2)(cid:6)(cid:16)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:38)(cid:32)(cid:32) (cid:37)(cid:32)(cid:32) (cid:1)(cid:6)(cid:9)(cid:5)(cid:14)(cid:20) (cid:1)(cid:6)(cid:10)(cid:20)
(cid:36)(cid:32)(cid:32) (cid:2)(cid:6)(cid:15)(cid:9)(cid:9)(cid:4)(cid:3) (cid:35)(cid:32)(cid:32) (cid:1)(cid:6)(cid:11)(cid:20) (cid:2)(cid:6)(cid:14)(cid:9)(cid:9)(cid:4)(cid:3) (cid:34)(cid:32)(cid:32) (cid:1)(cid:6)(cid:12)(cid:20) (cid:1)(cid:6)(cid:14)(cid:20)
(cid:33)(cid:32)(cid:32) (cid:1)(cid:6)(cid:13)(cid:20) (cid:1)(cid:6)(cid:10)(cid:9)(cid:20)
(cid:32)
(cid:32) (cid:36) (cid:40) (cid:33)(cid:34) (cid:33)(cid:38)
(a)Inbound
(cid:29)(cid:22)(cid:27)(cid:28)(cid:26)(cid:9)(cid:17)(cid:13)(cid:4)(cid:15)(cid:19)(cid:16)(cid:22)(cid:9)(cid:13)(cid:17)(cid:13)(cid:6)(cid:13)(cid:15)(cid:9)(cid:21)(cid:13)(cid:25)(cid:2) (cid:3)(cid:13)(cid:23)(cid:23)(cid:13)(cid:21) (cid:7)(cid:23)(cid:9)(cid:23)(cid:16)(cid:11) (cid:4)(cid:26)(cid:19)(cid:9)(cid:18)(cid:16)(cid:11)
(cid:5)(cid:24)(cid:23)(cid:10)(cid:20)(cid:24)(cid:19)(cid:12)(cid:1)(cid:8)(cid:19)(cid:14)(cid:9)(cid:16)(cid:21)(cid:19)(cid:13)(cid:22)(cid:22)(cid:28)(cid:44)(cid:29)
(cid:3)(cid:13)(cid:23)(cid:23)(cid:13)(cid:21)
(b)Outbound
Figure4:EvaluationofDDP(NoArtificialDelay)-48MarketParticipants,22korders/sec,5MinuteDuration
ThebluepointS-ùë•¬µsindicatesastaticdelayparameterofùë•¬µs.TheredpointD-ùë¶%indicatesaDDPstrategywithatargetunfairnessratioofùë¶%.Thesame
notationalsoappliestoFig.5.
(cid:33)(cid:32)(cid:32)(cid:32) (cid:41)(cid:32)(cid:32) (cid:2)(cid:6)(cid:10)(cid:11)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:40)(cid:32)(cid:32) (cid:2)(cid:6)(cid:10)(cid:9)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:39)(cid:32)(cid:32)
(cid:38)(cid:32)(cid:32) (cid:2)(cid:6)(cid:17)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:37)(cid:32)(cid:32) (cid:2)(cid:6)(cid:16)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:36)(cid:32)(cid:32) (cid:2)(cid:6)(cid:15)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:35)(cid:32)(cid:32)(cid:1)(cid:6)(cid:9)(cid:5)(cid:14)(cid:20) (cid:2)(cid:6)(cid:14)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:34)(cid:32)(cid:32) (cid:2)(cid:6)(cid:13)(cid:9)(cid:9)(cid:4)(cid:3) (cid:33)(cid:32)(cid:32) (cid:2)(cid:6)(cid:11)(cid:9)(cid:9)(cid:4)(cid:3)
(cid:32) (cid:1)(cid:6)(cid:10)(cid:20) (cid:1)(cid:6)(cid:11)(cid:20) (cid:1)(cid:6)(cid:12)(cid:20) (cid:1)(cid:6)(cid:13)(cid:20) (cid:1)(cid:6)(cid:14)(cid:20)
(cid:32) (cid:33) (cid:34) (cid:35) (cid:36) (cid:37) (cid:38) (cid:39) (cid:40)
(cid:29)(cid:22)(cid:27)(cid:28)(cid:26)(cid:9)(cid:17)(cid:13)(cid:4)(cid:15)(cid:19)(cid:16)(cid:24)(cid:13)(cid:24)(cid:6)(cid:13)(cid:15)(cid:9)(cid:21)(cid:13)(cid:25)(cid:2)
(cid:3)(cid:13)(cid:23)(cid:23)(cid:13)(cid:21)
(cid:7)(cid:23)(cid:9)(cid:23)(cid:16)(cid:11)
(cid:4)(cid:26)(cid:19)(cid:9)(cid:18)(cid:16)(cid:11)
(cid:5)(cid:19)(cid:10)(cid:20)(cid:24)(cid:19)(cid:12)(cid:1)(cid:8)(cid:19)(cid:14)(cid:9)(cid:16)(cid:21)(cid:19)(cid:13)(cid:22)(cid:22)(cid:28)(cid:44)(cid:29)
(cid:3)(cid:13)(cid:23)(cid:23)(cid:13)(cid:21) (cid:33)(cid:32)(cid:32)(cid:32) (cid:41)(cid:32)(cid:32)
(cid:40)(cid:32)(cid:32) (cid:2)(cid:6)(cid:9)(cid:10)(cid:8)(cid:8)(cid:4)(cid:3)
(cid:39)(cid:32)(cid:32)
(cid:38)(cid:32)(cid:32) (cid:2)(cid:6)(cid:9)(cid:8)(cid:8)(cid:8)(cid:4)(cid:3)
(cid:37)(cid:32)(cid:32) (cid:2)(cid:6)(cid:15)(cid:8)(cid:8)(cid:4)(cid:3)
(cid:36)(cid:32)(cid:32) (cid:1)(cid:6)(cid:9)(cid:18) (cid:1)(cid:6)(cid:12)(cid:18) (cid:2)(cid:6)(cid:14)(cid:8)(cid:8)(cid:4)(cid:3)
(cid:35)(cid:32)(cid:32) (cid:1)(cid:6)(cid:8)(cid:5)(cid:13)(cid:18)
(cid:33) (cid:34) (cid:32) (cid:32) (cid:32) (cid:32) (cid:1)(cid:6)(cid:10)(cid:18) (cid:1)(cid:6)(cid:11)(cid:18) (cid:1)(cid:6)(cid:13)(cid:18) (cid:1)(cid:6)(cid:9)(cid:8)(cid:18)
(cid:32)
(cid:32) (cid:36) (cid:40) (cid:33)(cid:34) (cid:33)(cid:38)
(a)Inbound
(cid:29)(cid:22)(cid:27)(cid:28)(cid:26)(cid:9)(cid:17)(cid:13)(cid:4)(cid:15)(cid:19)(cid:16)(cid:22)(cid:9)(cid:13)(cid:17)(cid:13)(cid:6)(cid:13)(cid:15)(cid:9)(cid:21)(cid:13)(cid:25)(cid:2)
(cid:3)(cid:13)(cid:23)(cid:23)(cid:13)(cid:21)
(cid:7)(cid:23)(cid:9)(cid:23)(cid:16)(cid:11)
(cid:4)(cid:26)(cid:19)(cid:9)(cid:18)(cid:16)(cid:11)
(cid:5)(cid:24)(cid:23)(cid:10)(cid:20)(cid:24)(cid:19)(cid:12)(cid:1)(cid:8)(cid:19)(cid:14)(cid:9)(cid:16)(cid:21)(cid:19)(cid:13)(cid:22)(cid:22)(cid:28)(cid:44)(cid:29)
(cid:3)(cid:13)(cid:23)(cid:23)(cid:13)(cid:21)
(b)Outbound
Figure5:EvaluationofDDP(WithArtificialDelay)-48MarketParticipants,22korders/sec,5MinuteDuration,
PeriodicArtificialDelaysof0,400,or200¬µsEvery6Seconds
(cid:26)(cid:30)(cid:25)(cid:25)
(cid:26)(cid:27)(cid:25)(cid:25) (cid:26)(cid:25)(cid:34)(cid:31) (cid:26)(cid:25)(cid:29)(cid:29)
(cid:32)(cid:27)(cid:34) (cid:32)(cid:32)(cid:25)
(cid:34)(cid:25)(cid:25) (cid:31)(cid:32)(cid:33) (cid:30)(cid:32)(cid:32) (cid:31)(cid:30)(cid:33) (cid:31)(cid:25)(cid:25) (cid:28)(cid:31)(cid:30) (cid:28)(cid:27)(cid:26) (cid:28)(cid:27)(cid:25) (cid:28)(cid:27)(cid:27) (cid:30)(cid:25)(cid:33) (cid:29)(cid:33)(cid:28) (cid:30)(cid:26)(cid:33) (cid:28)(cid:25)(cid:34)
(cid:28)(cid:25)(cid:25)
(cid:25)
(cid:30)(cid:25)(cid:14) (cid:34)(cid:34)(cid:14) (cid:34)(cid:34)(cid:20)(cid:34)(cid:14)
(cid:22)(cid:15)(cid:19)(cid:21)(cid:18)(cid:8)(cid:12)(cid:9)(cid:16)(cid:6)(cid:3)(cid:12)(cid:13)(cid:10)(cid:15)(cid:15)(cid:10)(cid:11)(cid:7)(cid:17)(cid:5)
(cid:4)(cid:2)(cid:1)(cid:35)(cid:1)(cid:26) (cid:4)(cid:2)(cid:35)(cid:1)(cid:27) (cid:4)(cid:2)(cid:35)(cid:1)(cid:28) (cid:4)(cid:2)(cid:1)(cid:35)(cid:1)(cid:29) (cid:4)(cid:2)(cid:1)(cid:35)(cid:1)(cid:30) (cid:39)(cid:36)
(cid:37)(cid:44)(cid:31)(cid:40)
(cid:38)(cid:41) (cid:37)(cid:43)(cid:31)(cid:42)
(cid:38)(cid:36) (cid:37)(cid:41)(cid:31)(cid:40)
(cid:37)(cid:40)(cid:31)(cid:37) (cid:37)(cid:41) (cid:37)(cid:39)(cid:31)(cid:36) (cid:39)(cid:31)(cid:44) (cid:39)(cid:31)(cid:41) (cid:37)(cid:36) (cid:39)(cid:31)(cid:37) (cid:36)(cid:31)(cid:43) (cid:36)(cid:31)(cid:44)
(cid:41) (cid:38)(cid:31)(cid:40) (cid:38)(cid:31)(cid:43) (cid:36)(cid:31)(cid:41) (cid:36)(cid:31)(cid:42)
(cid:36)(cid:31)(cid:40)
(cid:36)
(cid:6)(cid:13)(cid:27)(cid:15)(cid:19)(cid:20)(cid:22)(cid:18)(cid:1)(cid:3)(cid:22)(cid:18)(cid:20)(cid:22)(cid:16) (cid:5)(cid:13)(cid:27)(cid:16)(cid:29)(cid:13)(cid:30) (cid:8)(cid:13)(cid:25)(cid:27)(cid:20)(cid:15)(cid:20)(cid:24)(cid:13)(cid:22)(cid:27)
(cid:3)(cid:6)(cid:16)(cid:9)(cid:12)(cid:8)(cid:18)(cid:1)(cid:5)(cid:16)(cid:6)(cid:16)(cid:10)(cid:15)(cid:16)(cid:10)(cid:8)(cid:15)
(a)SubmissionLatency
(cid:33)(cid:26)(cid:16)(cid:25)(cid:23)(cid:2)(cid:17)(cid:23)(cid:25)(cid:16)(cid:14)(cid:21)(cid:28)(cid:7)(cid:32)(cid:27)(cid:26)(cid:23)(cid:2)(cid:1)(cid:11)(cid:8)(cid:2) (cid:9)(cid:4)(cid:1)(cid:45)(cid:1)(cid:37) (cid:9)(cid:4)(cid:45)(cid:1)(cid:38) (cid:9)(cid:4)(cid:45)(cid:1)(cid:39) (cid:9)(cid:4)(cid:1)(cid:45)(cid:1)(cid:40) (cid:9)(cid:4)(cid:1)(cid:45)(cid:1)(cid:41)
(cid:12)(cid:6)(cid:10)(cid:30)(cid:24)(cid:16)(cid:26)
(b)CPUCost
Figure6:EvaluationofROS-48MarketParticipants,22korders/sec,5MinuteDuration
6 DISCUSSION capabilities include (1) limiting personnel with access to
Wenowdiscusssecurity,regulatory,andperformancecon- physicalinfrastructure,(2)auditingthelogsofaccessesto
cernsassociatedwithCloudExandalsooutlineavenuesfor VMs,and(3)controllingacloudcustomer‚Äôsaccesstospecific
futureworkonCloudEx. resourcesusingidentitymanagement[21].
Security.Weenvisionthataddressingsecurityconcernsin Regulation. Exchanges vary in the extent of their regula-
migrating an exchange to the public cloud would be best tion. At the one extreme, exchanges for cryptocurrencies
facilitatedbyatightfeedbackloopbetweenexchangeopera- (e.g.,Binance[24]andCoinbase[28])andauction/bidding
torsandcloudproviders.AWSGovCloud[22]andAzurefor platforms(e.g.,eBay)arerelativelyunregulated,whileex-
USGovernment[23]offerinsightsintopracticesdeployed changesforequities(e.g.,NASDAQ)aresubjecttoregula-
when migrating infrastructure that hosts highly sensitive tionsbygovernmentagencies(e.g.,FINRAandtheSECinthe
andaccess-controlledinformation.Forexample,GovCloud US).Theseregulationsarelocation-dependentandinclude
101

CloudEx:AFair-AccessFinancialExchangeintheCloud HotOS‚Äô21,May31‚ÄìJune2,2021,AnnArbor,MI,USA
RegNMSintheUS[40]andMiFIDII[38]inEurope.While statistics-infographic.pdf.Accessed:2021-02-02.
CloudEx‚Äôsideasareapplicabletoalloftheseexchanges,the [7] Intel¬ÆSoftwareGuardExtensions.https://software.intel.com/content/
moreunregulatedexchangesdopresentaneasierpathto www/us/en/develop/topics/software-guard-extensions.html. Ac-
cessed:2021-02-02.
theshort-termadoptionofCloudEx.Forexchangeswhere
[8] MatchingOrdersDefinition.https://www.investopedia.com/terms/m/
regulationiscritical,wenotethatseveralotherfunctionsin matchingorders.asp.Accessed:2021-02-02.
thefinanceindustryandothercloselyregulatedindustries [9] Nasdaq Believes the Cloud Is the Future of Markets | Nas-
suchashealthcarehavesuccessfullymigratedtothecloud daq. https://www.nasdaq.com/articles/nasdaq-believes-the-cloud-
andthesecanpotentiallyserveasablueprintforfinancial is-the-future-of-markets-2020-06-24.Accessed:2021-02-02.
[10] Nasdaq Colocation. http://web.stanford.edu/class/cs349f/slides/
exchangesaswell[29].
CS349F_lec7_deutsche_precise_timing_in_finance.pdf. Accessed:
Performance. We identify a few areas of performance im- 2021-02-02.
provementinCloudEx.NetworkingprimitiveslikeDPDK [11] Nasdaq Ramps Up Cloud Move-All 28 of the Company‚Äôs Mar-
[3]andRDMA[31]canbeusedinsteadofZeroMQtolower kets Are Expected to Be Hosted in the Cloud within the Next
Decade. https://www.wsj.com/articles/nasdaq-ramps-up-cloud-
latency; throughput can be improved by employing fine-
move-11600206624.Accessed:2021-02-02.
grained locking of shared data structures; and unfairness
[12] NasdaqTechChiefCreditsCloudWithHelpingManageMarketFren-
caused by variability in latency measurements can be re- zies.https://www.wsj.com/articles/nasdaq-tech-chief-credits-cloud-
duced by using NIC hardware timestamps [1, 4]. The use with-helping-manage-market-frenzies-11611962716.Accessed:2021-
of bare-metal instances in the cloud can further improve 02-02.
[13] New Army of Individual Investors Flexes Its Muscle.
CloudEx‚Äôsperformance.
https://www.wsj.com/articles/new-army-of-individual-investors-
flexes-its-muscle-11609329600.Accessed:2021-02-02.
7 CONCLUSION [14] SEC.gov - Limit Orders. https://www.sec.gov/fast-answers/
Exchangeshavestartedmigratingfromcarefully-designed
answerslimithtm.html.Accessed:2021-02-02.
[15] SEC.gov - Market Orders. https://www.sec.gov/fast-
andbespokeinfrastructuretothenoisyandbest-effortpublic
answers/answersmktordhtm.html#:~:text=A%20market%20order%
cloud.Inthispaper,wepresentCloudEx‚Äîafair-accesscloud 20is%20an,be%20executed%20is%20not%20guaranteed. Accessed:
exchange.Wearecurrentlypursuingthreemainavenuesfor 2021-02-02.
futureresearch.FirstisimprovingCloudEx‚Äôsperformanceas [16] Self-RegulatoryOrganizations;InvestorsExchangeLLC;OrderAp-
describedin¬ß6.Second,weplantouseCloudExasamarket provingaProposedRuleChangetoAddaNewDiscretionaryLimitOr-
derTypeCalledD-Limit.https://www.sec.gov/rules/sro/iex/2020/34-
simulatorforconductingresearchonexchangedesign(e.g.
89686.pdf.Accessed:2021-02-02.
newauctionmechanisms[25]andordertypes[16]).Third, [17] ZeroMQ.https://zeromq.org/.Accessed:2021-02-02.
webelievethetechniquesinCloudExareapplicablebeyond [18] MachineTypes|ComputeEngineDocumentation|GoogleCloud.
financialexchangestodomainssuchasadexchanges[19], https://cloud.google.com/compute/docs/machine-types, 2020. Ac-
massivelymultiplayergames,andmulti-agentcontrol.We cessed:2021-02-02.
[19] SebastianAngelandMichaelWalfish.VerifiableAuctionsforOnline
alsointendtoopensourceCloudExasweenvisionitsmost
AdExchanges.InProceedingsoftheACMSIGCOMM2013conference
compelling use cases will be through its use as an open
onSIGCOMM,pages195‚Äì206,2013.
platformforteachingandresearch. [20] MatteoAquilina,EricBBudish,andPeterO‚ÄôNeill. Quantifyingthe
High-FrequencyTrading‚ÄúArmsRace‚Äù:ASimpleNewMethodology
REFERENCES andEstimates.ChicagoBoothResearchPaper,(20-16),2020.
[21] AWS.AmazonGuardDuty.https://aws.amazon.com/guardduty/.Ac-
[1] Azure: Accelerated Networking. https://azure.microsoft.com/en-
cessed:2021-05-09.
us/blog/maximize-your-vm-s-performance-with-accelerated- [22] AWS.AWSGovCloud.https://aws.amazon.com/govcloud-us/?whats-
networking-now-generally-available-for-both-windows-and-linux/. new-ess.sort-by=item.additionalFields.postDateTime&whats-new-
Accessed:2021-02-02. ess.sort-order=desc.Accessed:2021-05-09.
[2] Beyond Flash Boys: Improving Transparency [23] Azure. AzureforUSGovernment. https://azure.microsoft.com/en-
and Fairness in Financial Markets. http://
us/global-infrastructure/government/.Accessed:2021-05-09.
video.cfainstitute.org/services/player/bcpid3577743869001?bckey=
[24] Binance. BitcoinExchange|CryptocurrencyExchange|Binance.
AQ~~,AAABE5oc3_E~,Leu10fA0D1sc9Dh9wz3oyrstQJ-
https://www.binance.com.Accessed:2021-05-09.
PkzpJ&bctid=4436841897001.Accessed:2021-02-02.
[25] EricBudish,PeterCramton,andJohnShim. TheHigh-Frequency
[3] DPDK-DataPlaneDevelopmentKit.https://www.dpdk.org/.Accessed:
TradingArmsRace:FrequentBatchAuctionsasaMarketDesign
2021-02-02.
Response.TheQuarterlyJournalofEconomics,130(4):1547‚Äì1621,2015.
[4] Enhanced Networking on Linux - Amazon Elastic Compute
[26] FayChang,JeffreyDean,SanjayGhemawat,WilsonC.Hsieh,Debo-
Cloud. https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/
rahA.Wallach,MikeBurrows,TusharChandra,AndrewFikes,and
enhanced-networking.html.Accessed:2021-02-02.
RobertE.Gruber. Bigtable:ADistributedStorageSystemforStruc-
[5] FastFactsaboutVanguard.https://about.vanguard.com/who-we-are/
turedData.ACMTrans.Comput.Syst.,26(2),June2008.
fast-facts/.Accessed:2021-02-02.
[27] James Cipar, Qirong Ho, Jin Kyu Kim, Seunghak Lee, Gregory R.
[6] FidelityInvestments:Q2Highlights. https://www.fidelity.com/bin-
Ganger,GarthGibson,KimberlyKeeton,andEricXing.Solvingthe
public/060_www_fidelity_com/documents/about-fidelity/corporate-
StragglerProblemwithBoundedStaleness.In14thWorkshoponHot
102

HotOS‚Äô21,May31‚ÄìJune2,2021,AnnArbor,MI,USA Ghalayini,etal.
TopicsinOperatingSystems(HotOSXIV),SantaAnaPueblo,NM,May [34] Kaplan Ken. Keeping Financial Traders Connected Remotely
2013.USENIXAssociation. During the COVID-19 Crisis. https://www.nutanix.com/
[28] Coinbase.Coinbase.https://www.coinbase.com.Accessed:2021-05- theforecastbynutanix/industry/how-jm-finn-kept-remote-stock-
09. traders-connected-during-covid-19.Accessed:2021-02-02.
[29] Forbes. ManyHighlyRegulatedCompaniesHaveMadetheLeap [35] Yow-JianLin,KatherineGuo,andSanjoyPaul.Sync-MS:Synchronized
to the Cloud ‚Äî You Can, Too. https://www.forbes.com/sites/ MessagingServiceforReal-TimeMulti-PlayerDistributedGames.In
forbestechcouncil/2021/04/30/many-highly-regulated-companies- 10thIEEEInternationalConferenceonNetworkProtocols,2002.Proceed-
have-made-the-leap-to-the-cloud-you-can-too/?sh=43f25d7a192d. ings.,pages155‚Äì164.IEEE,2002.
Accessed:2021-05-09. [36] VasiliosMavroudisandHaydenMelton.Libra:FairOrder-Matching
[30] YilongGeng,ShiyuLiu,ZiYin,AshishNaik,BalajiPrabhakar,Mendel forElectronicFinancialExchanges. InProceedingsofthe1stACM
Rosunblum,andAminVahdat.ExploitingaNaturalNetworkEffect ConferenceonAdvancesinFinancialTechnologies,pages156‚Äì168,2019.
forScalable,Fine-GrainedClockSynchronization. InProceedingsof [37] D.L.Mills.Internettimesynchronization:thenetworktimeprotocol.
the15thUSENIXConferenceonNetworkedSystemsDesignandImple- IEEETransactionsonCommunications,39(10):1482‚Äì1493,1991.
mentation,NSDI‚Äô18,pages81‚Äì94,Berkeley,CA,USA,2018.USENIX [38] OfficialJournaloftheEuropeanUnion. OfficialJournaloftheEu-
Association. ropeanUnion-MifidIIExecutionVenueDataandQualityofExe-
[31] ChuanxiongGuo,HaitaoWu,ZhongDeng,GauravSoni,JianxiYe, cution.https://eur-lex.europa.eu/legal-content/EN/TXT/PDF/?uri=
JituPadhye,andMarinaLipshteyn.RDMAoverCommodityEthernet CELEX:32017R0575&from=EN.Accessed:2021-05-09.
atScale.InProceedingsofthe2016ACMSIGCOMMConference,SIG- [39] DavidSchneider.TheMicrosecondMarket.IEEEspectrum,49(6):66‚Äì81,
COMM‚Äô16,page202‚Äì215,NewYork,NY,USA,2016.Associationfor 2012.
ComputingMachinery. [40] SEC.SecuritiesandExchangeCommission-RegulationNMS.https:
[32] NeilJohnson,GuannanZhao,EricHunsader,JingMeng,AmithRavin- //www.sec.gov/rules/final/34-51808.pdf.Accessed:2021-05-09.
dar,SpencerCarran,andBrianTivnan.FinancialBlackSwansDriven [41] IainSheridan. MiFIDIIintheContextofFinancialTechnologyand
byUltrafastMachineEcology.arXivpreprintarXiv:1202.1448,2012. RegulatoryTechnology.CapitalMarketsLawJournal,12(4):417‚Äì427,
[33] BrandonKeim.NanosecondTradingCouldMakeMarketsGoHaywire. 2017.
Wired,February,16,2012. [42] MaoYe,ChenYao,andJiadingGai.TheExternalitiesofHighFrequency
Trading.WBSFinanceGroupResearchPaper,(180),2013.
103

