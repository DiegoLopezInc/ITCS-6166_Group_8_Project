DBO: Fairness for Cloud-Hosted Financial Exchanges
EashanGupta PrateeshGoyal IliasMarinos
UIUC,MicrosoftResearch MicrosoftResearch MicrosoftResearch
ChenxingyuZhao RadhikaMittal RanveerChandra
UniversityofWashington, UIUC MicrosoftResearch
MicrosoftResearch
Abstract tosignificantlyreducetheircapitalexpenditure,improvescalabil-
ityandreduceoperationalburden.Keymarketparticipantsofsuch
Weconsidertheproblemofhostingfinancialexchangesinthecloud.
exchangeswouldsimilarlyprofitfromsuchmigrationastheyalso
Exchangesnecessitatestrongfairnessguaranteesforcompetingpar-
currentlymaintainanexpensiveon-premiseinfrastructurefordata
ticipants,particularlyforusecasessuchasâ€œhighfrequencytradingâ€.
analysisandregressionmodellingtoformulatetheirtradingstrate-
Today,exchangesachievesuchguaranteesbyprovidingequalla-
gies.ForcloudproviderssuchasAmazon,Google,andMicrosoft,
tencyacrossallmarketparticipantsintheiron-premisedeployments.
thisisabigbusinessopportunity.Migratingfinancialexchangesto
However,ensuringequallatencyforfairnessisnotablychallenging
thecloudisamutuallybeneficialundertakingforallpartiesinvolved.
incurrentmulti-tenantclouddeployments,mainlyduetofactors
To this end, cloud providers and financial exchanges have an-
suchasnetworkcongestionandnon-equidistantnetworkpaths.
nouncedlong-termpartnershipstofacilitatesuchamove[21,22].
Inthispaper,weaddresstheproblemofunfairnessstemming
Bothpartiesperceivethatthismigrationwillbequitechallenging,
fromunpredictableandunboundednetworklatencyincloudnet-
especiallywhenconsideringalldifferentworkloads(businesses)that
works.Takinginspirationfromtheuseoflogicalclocksindistributed
arecurrentlyaccommodatedintheexchangesâ€™on-premiseinfras-
systems,wepresentDeliveryBasedOrdering(DBO),anovelmech-
tructure.Inthispaper,wefocusonâ€œspeedraceâ€trading[11,19]
anism that guarantees fairness by post-hoc offsetting the latency
whichisanimportantandhighlyprofitablebusinessforbothfinan-
differencesamongmarketparticipantsinthecloud.Wethoroughly
cialexchangesandthemarkettraders.Briefly,â€œspeedraceâ€trading
evaluateDBOinsimulation,abare-metaltestbedandapubliccloud
isaformofsystematicelectronictradingwheremarketparticipants
deployment, and we demonstrate that it is feasible to guarantee
(MPs)usehigh-performancecomputerstoexecutestrategiesthataim
fairnesswhileoperatingathightransactionrateswithasub-100Âµs
torapidlyreactandexploitnewopportunitiespresentedinthemar-
end-to-endlatency.
ket(e.g.,duetovolatility,pricediscrepanciesetc).High-Frequency
CCSConcepts Traders (HFTs) engage in such speed racing. HFTs invest large
â€¢Appliedcomputingâ†’Onlineauctions;â€¢Networksâ†’Network amountsofmoneyforhardware,systemsandalgorithmicdevelop-
protocoldesign;Networkarchitectures; menttoachieveimpressivelylowreactiontimes(Âµs-orevenns-
scale).Thistradingbusinessisonlyviableifmarketparticipantscan
Keywords
competeinafairplaygroundguaranteedbytheCentralExchange
Financialexchange,Logicalclock,Cloud,Fairness,HighFrequency Server(CES)operators.Equalityofopportunityâ€“fairnessâ€“inthis
Trading casemeansthatallmarketparticipantsmustgetprovablysimultane-
ousaccesstomarketdata,aswellastheirsubsequenttradesmustbe
ACMReferenceFormat:
EashanGupta,PrateeshGoyal,IliasMarinos,ChenxingyuZhao,Radhika executedintheexactordertheyweregenerated(i.e.placedinthe
Mittal,andRanveerChandra.2023.DBO:FairnessforCloud-HostedFinan- wire).
cialExchanges.InACMSIGCOMM2023Conference(ACMSIGCOMM Withon-premisedeployments,financialexchangesguaranteefair-
â€™23),September10,2023,NewYork,NY,USA.ACM,NewYork,NY,USA, ness for speed race trading by guaranteeing equal bi-directional
14pages.https://doi.org/10.1145/3603269.3604871 latencytotherelevantmarketparticipants.Exchangesgotoagreat
extenttoensurefairnessfortheirco-locatedMPcustomers;itis
1 Introduction
not uncommon, for example, to use layer-1 fan-out switches for
MajorfinancialexchangessuchasNASDAQ,ChicagoMercantile market data stream replication and equal-length cables to all co-
Exchange(CME),andLondonStockExchange(LSE)haverecently locatedMPs.Onthecontrary,publicclouddatacenternetworksdo
expressedinterestinmigratingtheirworkloadstothecloud,aiming notprovidesuchguaranteesastheywereoriginallydesignedfora
heterogeneous,multi-tenantenvironment,aimingtoaccommodate
Permissiontomakedigitalorhardcopiesofallorpartofthisworkforpersonalor
classroomuseisgrantedwithoutfeeprovidedthatcopiesarenotmadeordistributed diverse workloads. Even if the MPs are located within the same
forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation cloud region as the CES, it is hard to guarantee that the latency
onthefirstpage.Copyrightsforcomponentsofthisworkownedbyothersthanthe
betweenCESandvariousMPswillbethesame.Copperandfiber
author(s)mustbehonored.Abstractingwithcreditispermitted.Tocopyotherwise,or
republish,topostonserversortoredistributetolists,requirespriorspecificpermission opticscablesarenotnecessarilyofequallength,networktrafficis
and/orafee.Requestpermissionsfrompermissions@acm.org. notevenlybalancedamongthedifferentpaths,multiplevendorsâ€™net-
ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA
workelementshavedifferentperformancecharacteristics,network
Â©2023Copyrightheldbytheowner/author(s).PublicationrightslicensedtotheAsso-
ciationforComputingMachinery. over-subscriptionisstillcommon,andnetworkqualityofservice
ACMISBN979-8-4007-0236-5/23/09...$15.00 mechanismsforconcurrentworkloadsareonlybesteffort.
https://doi.org/10.1145/3603269.3604871
550

ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA E.Guptaetal.
Thisproblemhasrecentlyreceivedsomeattentionfromtheaca-
demic community. CloudEx [13] aims to achieve fairness by at-
temptingtoprovideequal(yetinflated)bi-directionallatenciesin
thecloudrelyingontightclocksynchronizationandbufferingfor
market data delivery. As we explain later (Â§2), such approaches
are fragile because latencies in datacenter networks are not only
unpredictable,butalsounbounded.Otherproposals[11,19],require
intrusivemodificationstoexistingCESimplementationstowork.
Inthispaper,weseektoaddresstheproblemoffairnessforspeed
racetradingincloudenvironments.Ourkeyinsightisthatequal
bi-directionallatenciesarenotstrictlyrequiredtoachievefairness.
For speed trading, instead of ex-ante equalizing latency, we can
ex-postfactocorrectforanylatencydifferencesindeliveryofdata
byorderingtradesdifferently.Weintroducelogicaldeliveryclocks
that track time at each trader relative to when market data were
received.WepresentDeliveryBasedOrdering(DBO),amechanism
that uses delivery clocks to order trades and achieve guaranteed
fairness1innetworktopologieswherelatencyisunpredictableand
unbounded.Beyondguaranteedfairness,DBOhastwootheradvan-
tages.First,DBOdoesnotrequireanyclock-synchronizationwhat-
soever,whichisnotoriouslyhardtoachieveincloudenvironments
where the network latency is unpredictable and unbounded [17].
Second,comparedtoothersolutions,DBOachievessignificantly
lowerend-to-endlatency.
WeimplementarealDBOsystem,whichweevaluateonabare-
metalservertestbedleveragingprogrammableNICs.Wealsoeval-
uateDBOinapublicclouddeploymentusingstandardVMs:our
system achieves guaranteed fairness and sub-100us p99 latency
whileservicing125Ktradespersecond.
2 Background
We begin with discussing the challenges in hosting financial ex-
changesonthecloud,thatarederivedfromourdiscussionswith
threemajorfinancialexchanges(allareamongthetop10exchanges
in the world by trading volume) and our review of papers from
financialacademiccommunity[9,11,18,19]aswellasindustry
papers[3,10].
Whyismovingtothecloudsohard?ShortAnswer:Itishardto
achievefairnessincloud.Akeycustomer/businessforanymajorfi-
nancialexchangeisHighFrequencyTraders(HFTs).Atahighlevel,
highfrequencytradersaimtoprocessincomingmarketdatafeed
fromtheexchangeserverandplacetradeordersasfastaspossible.
Thesetradersareengagedinwhatisknownasspeedraceswhere
theyarecompetingforthesametradingopportunity,tryingtoget
theirtradeordersaheadofcompetition.Thereisanarmsraceinhigh
frequencytraderstorespondtomarketdatathefastest[11].HFTs
arebecomingfasterwithtime,evenminordifferencesinlatency
(sub-microsecondlevel)formarketdatadeliveryandtradeorders
cangiveatradersignificantadvantage/disadvantageovertherest
[9,10,18].Allowingsuchtraderstocompetefairlyiscriticalfor
anyexchangetoattractHFTsthatbringsignificantliquiditytothe
exchange.Ensuringsuchfairnessinclouddatacenternetworks,how-
ever,isquitechallengingastheyexhibitnon-deterministicnetwork
latencyduetoreasonsexplainedinÂ§1.Exchangesnotonlywant
fairness;tospeeduppricediscoverytheyalsowantlowlatency.The
1DBOachievesLimitedHorizonResponseTimeFairness(seeDef.2).
gniogtuO
ataD
tekraM
gnimocnI
edarT
CES
OB
RBâ‚ RBáµ¢ RBâ‚™
â€¦ â€¦
MPâ‚ MPáµ¢ MPâ‚™
Figure1:BasiccomponentsofDBO.
Unfairness
CloudEx
Inflated
latency
Network Latency
Time
ycnetal
dne-ot-dnE
Figure2:Clock-synchronizationisnotenoughâ€”Thisfigureshowsthe
latencywithCloudEx.Evenwithperfectclock-synchronization,CloudEx
incursbothunfairnessandinflatedlatency.
latencyrequirementshighlydependontheexchange,rangingfrom
sub-100microsecondtomillisecond [3].
Howexchangesenablefairspeedracingtoday?ShortAnswer:
Equalbi-directionallatency.Majorexchangesoperatetheirowndat-
acenters.HFTtradersthatwanttoengageinspeedtradingcolocate2
totheexchangedatacenter.
Thecentralexchangeserver(CES)producesarealtimemarket
datafeedanddistributesittoallthecolocatedparticipants(MPs).
The exchange datacenter is optimized to ensure that participants
getallthemarketdatapointsatthesametime.Further,exchanges
ensurethatallthetradesplacedbytheparticipantsexperiencethe
samelatencytotheexchangeserver.Theexchangeserversimply
processesthetradesinafirst-come-first-serve(FCFS)manner.Op-
timizingdatacenterstoprovidesuchequalbi-directionallatencyis
expensive[3].Asaresultofhighcost,exchangeschargeasubstan-
tialpremiumforsuchcolocation(NASDAQcharges$600,000per
customerforcolocationanddirectdatafeed[3]).Theprohibitive
colocationcostsestablishasignificantentrybarriertothedomainof
high-frequencytrading.Majorexchangeswouldalsobeinterestedin
settingupregionalexchangesbutthecostofcreatinganewregional
datacenterisprohibitivelyhigh.
2.1 RelatedWork
Theproblemofmigratingfinancialexchangestothecloudhasre-
ceivedsomeattention.Therearetwofundamentallydifferentap-
proaches.
2Exchangessupportcolocationforalimitednumberofparticipants.Theexactnumbers
areconfidential,butthenumberisin10stolessthancoupleofhundreddependingon
theexchange.
551

DBO:FairnessforCloud-HostedFinancialExchanges ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA
Clock-synchronizationbasedsolutions:CloudEx[13]proposes Notation Definition
usingclocksynchronizationtoachieveanequallatencyabstraction.
ğº(ğ‘¥) RealTimeatwhichğ‘¥wasgeneratedattheCES.
CloudExaddstwonewcomponentstothearchitecture(asshown
ğ·(ğ‘–,ğ‘¥) RealTimeatwhichğ‘¥ wasdelivered(byğ‘…ğµğ‘– incaseof
oursystem)toMPğ‘–.
in Figure 1): (i) For each participant there is a colocated trusted
ğ‘‡ğ‘ƒ(ğ‘–,ğ‘) Marketdatapointusedtogenerate(ğ‘–,ğ‘).
component called the release buffer (RB), which buffers market ğ‘…ğ‘‡(ğ‘–,ğ‘) Responsetimeof(ğ‘–,ğ‘).
datapoints,enablingadelayeddeliverytothemarketparticipant. ğ‘†(ğ‘–,ğ‘) RealTimeatwhich(ğ‘–,ğ‘)wassubmittedbyMPğ‘–.
(ii)Likewise,theorderingbuffer(OB)attheCESbuffersthetrade ğ¹(ğ‘–,ğ‘) RealTimeatwhich (ğ‘–,ğ‘) isforwarded(byOBinour
ordergeneratedbytheparticipants,enablingdelayedandre-ordered system)totheCESâ€™smatchingengine(ME).
deliveryofthetradeorderstotheCES.Clocksynchronizationex- ğ‘‚(ğ‘–,ğ‘) Dictatestheorderinwhichtradesareforwarded(byOB
cluded,thebroaderarchitectureofoursolutioncloselymirrorsthat inoursystem)totheCES.Ifğ‘‚(ğ‘–,ğ‘) < ğ‘‚(ğ‘—,ğ‘) then
ofCloudEx.
ğ¹(ğ‘–,ğ‘) <ğ¹(ğ‘—,ğ‘).
InCloudEx,allthecomponentshavesynchronizedclocks.Amar- Table1:Notation.
ketdatapointproducedattimeğ‘¡ isreleasedbythereleasebuffers
simultaneouslyatapre-specifiedtimeğ‘¡+ğ¶ 1.Atradeordergenerated that responds to market data faster no longer has a competitive
bytheparticipantattimeğ‘¡ isforwardedtotheCESbytheordering advantage.Toachievefairnessinenvironmentswithunpredictable
bufferattimeğ‘¡+ğ¶ 2.Theproblemwiththissolutionisthatevenwith networklatency,Libra[19]assignsrandomprioritiestotheincoming
perfectclocksynchronization,ifnetworklatencyspikesbeyondthe trades.Libraachievesfairnessforspeedracesstochastically(faster
pre-specifiedthresholds,thensuchasystemincursunfairness(see participantstradesareorderedaheadmorethan50%ofthetimes)
Figure2).Cloudnetworksexperiencelatencyspikesthatareacouple when the variability in network latency is bounded. Beyond the
ofordersofmagnitudehigherthantheaverage[20].TuningCloudEx issuesstatedhere,themainproblemwithboththesesolutionsisthat
thresholdstoachievefairnessishard:latencyspikes,althoughrare, theyrequireintrusivechangestotheexchangematchingalgorithm.
arestillbothunpredictableandunbounded.Furthermore,byconser-
3 ProblemStatement
vativelysettingveryhighthresholdsforbetterfairness,thesystem
wouldincurhighlatencyevenwhentheunderlyingnetworkiswell
Goals:Inthispaper,weaimtoenablefaircompetitioninspeed
behaved.Safeguardingagainsttailspikes,increasestheoverallend-
racingamonghighfrequencytradersinnetworkenvironmentswhere
to-endlatency(ğ¶ 1 +ğ¶ 2)notonlyatthetailbutonaverageaswell latencyis unpredictableandunbounded.Wealsodonot wishto
(seeFigure2).Moreimportantly,themainissueremainsunsolved:
modifythematchingenginetoachievethisgoal.Atahighlevel,
still,thereisnoguaranteethatequalbidirectionallatencywillalways
oursolutionexploitsthecharacteristicsofspeedracestosuggesta
hold.Infact,thereisaknownimpossibilityresultonthis.
newformoflogicaltimekeeping-deliveryclocks-thatmonitors
Impossibilityresultforequalbi-directionallatency:Innetworken- timeaccordingtowhenmarketdataaredeliveredtotheparticipants.
vironments with unpredictable and unbounded latency (common Byorderingtradesusingthisdeliverytimedomainwecanachieve
networkmodelisdistributedsystems[15]),evenwithperfectlysyn- guaranteedfairnessforsuchspeedraces.Ourgoalhereisnotto
chronizedclocks,itisimpossiblefortwomachinestocommunicate justproposeasolution,butalsopresenttheoreticalinsightsthathelp
andco-ordinatetodoataskatthesametime(twogeneralsproblem researchersinunderstandingthisspaceandenablefuturework.
[14]).Sotworeleasebufferscanneverco-ordinatetodeliverthe Non-goals:Achievingboundedlatencyincloudnetworksremains
samedatatotherespectivemarketparticipantssimultaneously,no an open problem as of now. In this paper, we do not attempt to
matterhowtheycommunicatewiththeCESorotherreleasebuffers. optimizetheunderlyingnetworklatencyorthetransportmechanism
Notethatitisstillpossibletoco-ordinateattheOBtoensurethat formulticastingmarketdataorcommunicatingtradeorders.Wealso
latencyonthereversepathstaysthesame(i.e.,twotradesgenerated donotdiscusssolutionsforreliabilityofthevariouscomponents.
atthesametimeareforwardedtotheCESatthesametime). Exchangestodayincurunfairnessintheeventoffailures[10].In
ImpossibilityResultonClockSynchronization:Further,innetwork oursystem,itshouldbepossibletodetectfailureofvariouscompo-
environmentswithunboundednetworklatency,itisalsoimpossible nentsandmigratetheimpactedcomponents.Duringfailures,either
tosynchronizeclockstoanyextentandtheerrorinclocksynchro- fairnessorlatencycangetaffected(Â§4.2.1).
nizationisunbounded[17]. Wewillnowintroducesomenotation,formallydefineaspeed
Ourconversationsrevealthatexchangeswishtoprovideguar- raceandfairnessforsuchraces.Thesedefinitionsarebasedonour
anteedfairnessandasaresult,suchsolutionshavenâ€™tseenmuch discussionswithfinancialexchangesandpapersfromacademia[9,
adoption. 11,18,19]andindustry[3,10].
Modifying how the matching engine behaves: Frequent Batch
Notation:Werefertotheğ‘¥ğ‘¡â„ marketdatapointasğ‘¥.(ğ‘–,ğ‘)refersto
Auctions[11]proposesreleasingmarketdataperiodicallyinbatches.
theğ‘ğ‘¡â„
tradefromMPğ‘–.Table1liststhenotationsusedinthispaper.
Thebatchfrequencyiskeptverylow(1batchper100ms)toallow Figure3showsthemajoreventsinaspeedrace.
all participants to respond before the next batch is released. All Speedrace:Informally,aspeedrace[9,11,19]consistsoftrades
thetradescorrespondingtoabatcharegiventhesamepriorityfor frommultipleparticipantscompetingforthesametradingopportu-
executionattheCES.Thissolutionensuresfairnessinthesense nity.Aparticularmarketdatapointservesasthetrigger/stimulus
thatnoparticipanthasanadvantageoverothersbecauseofnetwork fortradescompetinginthespeedrace.Participantsaimtoidentify
latency.However,thesystemlatencyishigh(100ms!).Further,this thetradingopportunityandwinthespeedracebyrespondingasfast
solution completely eliminates the speed races and a participant aspossibleafterreceivingthetriggermarketdatapoint.Thetrades
552

ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA E.Guptaetal.
G(x) F(i, a) F( j, b) and(ğ‘—,ğ‘)
CES
ğ¶1:ifğ‘‡ğ‘ƒ(ğ‘–,ğ‘)=ğ‘‡ğ‘ƒ(ğ‘—,ğ‘)=ğ‘¥
RT(i, a)
âˆ§ğ‘…ğ‘‡(ğ‘–,ğ‘) <ğ‘…ğ‘‡(ğ‘—,ğ‘),
MP
i D(i, x) S(i, a) then,ğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘—,ğ‘).
MP
RT( j, b)
Theaboveconditionissimplystatingthatafasterparticipantâ€™s
j D( j, x) S( j, b) trades should be ordered ahead of slower participant. The above
Figure3:Eventsinaspeedrace. conditionisfromtheperspectiveoftheparticipants.Responsetime
isnotdirectlyvisibletothecloudproviderortheexchanges.We
belongingtoaspeedracearethemostlatencysensitive[9,11,19]. willrewritetheaboveconditionsusingquantitiesvisibletothem.
Differencesinlatencyacrossparticipantsindeliveringthetrigger Theaboveconditioncanberewrittenas,
pointoronthereversepathtotheCEScancreatesignificantdisad-
vantagesforcertainparticipants[9,18].Thesespeedtradesconsti- ğ¶1â€² : ifğ‘‡ğ‘ƒ(ğ‘–,ğ‘)=ğ‘‡ğ‘ƒ(ğ‘—,ğ‘)=ğ‘¥
tuteasubstantialfractionoftheoveralltradesinmajorexchanges âˆ§ğ‘†(ğ‘–,ğ‘)âˆ’ğ·(ğ‘–,ğ‘¥) <ğ‘†(ğ‘—,ğ‘)âˆ’ğ·(ğ‘—,ğ‘¥),
(atleast20%inLSE[9]).Inthispaper,wewilltrytoachievefair
then,ğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘—,ğ‘).
orderingfortradesengagedinsuchspeedraces.
Computemodelforspeedtrades:Theresponsetimefortrade(ğ‘–,ğ‘), This condition states that the exchange can achieve response
ğ‘…ğ‘‡(ğ‘–,ğ‘),whosetriggerpointisğ‘¥ (i.e.,ğ‘‡ğ‘ƒ(ğ‘–,ğ‘) =ğ‘¥),isdefinedas timefairnessbymeasuringtimeoftradesrelativetowhenamarket
thetimeittooktogeneratethetradeafterreceivingthetriggerpoint participantreceivedthemarketdatatoordertrades.
ğ‘¥.Formally,thetimetrade(ğ‘–,ğ‘)issubmitted/generatedbyanMPis Addingğº(ğ‘¥),i.e.thegenerationtimeofğ‘¥,tobothsidesofthe
givenby, equationresultsinthefollowingcondition:
ğ‘†(ğ‘–,ğ‘)=ğ·(ğ‘–,ğ‘¥ =ğ‘‡ğ‘ƒ(ğ‘–,ğ‘))+ğ‘…ğ‘‡(ğ‘–,ğ‘) (1) ğ¶1â€²â€² : ifğ‘‡ğ‘ƒ(ğ‘–,ğ‘)=ğ‘‡ğ‘ƒ(ğ‘—,ğ‘)=ğ‘¥
âˆ§ğ‘†(ğ‘–,ğ‘)âˆ’(ğ·(ğ‘–,ğ‘¥)âˆ’ğº(ğ‘¥)) <ğ‘†(ğ‘—,ğ‘)âˆ’(ğ·(ğ‘—,ğ‘¥)âˆ’ğº(ğ‘¥)),
where ğ‘†(ğ‘–,ğ‘) is the timestamp at which trade (ğ‘–,ğ‘) is submit- then,ğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘—,ğ‘).
ted/generatedbyanMP,andğ·(ğ‘–,ğ‘¥ =ğ‘‡ğ‘ƒ(ğ‘–,ğ‘))isthetimeatwhich
ğ‘…ğµ ğ‘– deliversğ‘¥ toğ‘€ğ‘ƒ ğ‘– (seeTable1).
Hereğ·(ğ‘–,ğ‘¥)âˆ’ğº(ğ‘¥)representstheonewaylatencyfromCESto
participantğ‘–fordatapointğ‘¥.Sotoachieveresponsetimefairness
Responsetimecapturesthespeedofaparticipant.Notethatsuch
alltheexchangeneedstodoiscorrectforthedifferencesinlatency
atrademightbegeneratedusingmarketdatapointsotherthanthe
fromtheexchangetotheparticipant.
trigger point. However, the trade submission time is completely
To deal with variability in network latency, CloudEx tries to
governedbythedeliverytimeofthetriggerpointandtheresponse
equalizelatencybyholdinginformationatthereleasebufferand
timeoftheparticipantforthattrade.
releasingitsimultaneouslytoallparticipantsusingsynchronized
Fairorderingoftradesinaspeedrace:Outcomeofaspeedrace clocks.Inotherwords,itstrivestoensurethat(ğ·(ğ‘–,ğ‘¥)âˆ’ğº(ğ‘¥))is
issimplygovernedbytheorderingofthecompetingtradesinthe equalto(ğ·(ğ‘—,ğ‘¥)âˆ’ğº(ğ‘¥)),sothattradescansimplybeorderedby
race.Ourgoalistoachievethesameorderingforthesetradeshad thetimewhentheyweresubmittedbytheparticipants(i.e.ğ‘†(ğ‘–,ğ‘)).
thenetworkprovidedequalbi-directionlatency.Werefertosuchan However,asdiscussedearlier,itisnotpossibletoequalizelatency
orderingoftradesasResponseTimeFairness. alwayswhentheunderlyingnetworklatencyisunbounded.
Inanequalbi-directionallatencynetwork(ğ¶ 1latencyfromCES Inthiswork,wetakeadifferentapproach.Insteadoftryingto
toMPs,ğ¶ 2latencyfromMPstoCES),trade(ğ‘–,ğ‘)willbereceived
synchronizeclocksorequalizelatency(eitherofwhichcanneverbe
bytheCESattime, doneaccurately[14,17]),weshowthatitispossibletopostfacto
correctforlatencydifferenceandachieve(aslightlyweakerform
ğ¹(ğ‘–,ğ‘)=ğº(ğ‘¥ =ğ‘‡ğ‘ƒ(ğ‘–,ğ‘))+ğ¶ 1 +ğ‘…ğ‘‡(ğ‘–,ğ‘)+ğ¶ 2 (2) of)responsetimefairness.
Bydefinition,Trade(ğ‘–,ğ‘)isorderedaheadof(ğ‘—,ğ‘),i.e.,ğ‘‚(ğ‘–,ğ‘) < Causality of trades from a participant: We add an additional
ğ‘‚(ğ‘—,ğ‘)),ifğ¹(ğ‘–,ğ‘) <ğ¹(ğ‘—,ğ‘).Insuchanetwork,twotrades(ğ‘–,ğ‘)and requirementfororderingoftrades.Thisconditionsimplystatesthat
(ğ‘—,ğ‘)belongingtothesamerace(i.e.thesametriggerpointğ‘¥)will tradesfromaparticipantshouldrespectcausality,i.e,iftrade(ğ‘–,ğ‘)
beorderedasfollows, wasgeneratedbeforetrade (ğ‘–,ğ‘) thenitshouldbeorderedahead.
Formally,
Ifğº(ğ‘¥)+ğ¶
1
+ğ‘…ğ‘‡(ğ‘–,ğ‘)+ğ¶
2
<ğº(ğ‘¥)+ğ¶
1
+ğ‘…ğ‘‡(ğ‘—,ğ‘)+ğ¶
2
,
Ifğ‘†(ğ‘–,ğ‘) <ğ‘†(ğ‘–,ğ‘), then,ğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘–,ğ‘). (4)
then,ğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘—,ğ‘) (3)
Fairness beyond Response Time Fairness: While speed races
Usingtheaboveequation,wedefineresponsetimefairnessas arethemostlatencycritical,intheorytherecanbelatency-critical
follows, tradesthatdonâ€™tfallunderthespeedracemodel(e.g.,tradeswhose
submissiontimedependondeliverytimeofmultipledatapointsor
DEFINITION 1. Asystemachievesresponsetimefairnessifit someotherexternaldata).Guaranteeingperfectfairnessforsuch
satisfiesthefollowingconditionforallcompetingspeedtrades(ğ‘–,ğ‘)
tradesmightrequiresimultaneousdeliveryofbothmarketdataand
553

DBO:FairnessforCloud-HostedFinancialExchanges ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA
externaldata.Whilethisisimpossible,wewilldiscusshowDBO LEMMA 2. When trigger points are unknown, the necessary
canbeenhancedtoprovidebetterfairnessforsuchtrades(Â§4.2.6). conditionsonthedeliveryprocessesforachievingresponsetime
Assumptions:Wewilllistoutsomeoftheassumptionswemakein fairnessisgivenby,
oursolution. ğ·(ğ‘–,ğ‘¦)âˆ’ğ·(ğ‘–,ğ‘¥)=ğ·(ğ‘—,ğ‘¦)âˆ’ğ·(ğ‘—,ğ‘¥), âˆ€ğ‘–,ğ‘—,ğ‘¥,ğ‘¦.
Trust:Releaseandorderingbuffersaretrustedcomponentsthatare
PleaseseeAppendixAforproofofLemma2.
controlledbythecloudproviderandthatcannotbetamperedwith.
Thelemmastatesthattoachieveresponsetimefairness,theinter-
Proximity:Releasebuffersarecolocatedwiththeparticipants.The deliverytimesbetweendatapointsshouldbethesameacrossall
latencybetweenthemisnegligible.Inoursystem,weimplement participants.However,achievingthesameinter-deliverytimewhen
thereleasebufferatparticipantâ€™sNIC.Forscenarioswhererelease networklatencyisunboundedisalsoimpossible.Iftwoprocesses
buffercannotbecolocatedweanalyzetheimpactoflatencybetween canco-ordinatetoachievethesameinter-deliverytime,thenthey
thereleasebufferandtheparticipant(Â§4.2.3). canco-ordinatetodoataskatthesametime,acontradictionofthe
Clock-driftrate:Wedonâ€™tmakeanyassumptionsonclocksbeing twogeneralsimpossibilityresult.
â–¡
synchronizedacrosscomponentsinthenetwork.Similartoliterature
inthetraditionaldistributedsystems[17],weassumethatclock- We cannot achieve Response Time Fairness in settings where
driftrateisnegligibleandreleasebufferscanmeasuretime-intervals triggerpointsareunknown.Wedefineanewslightlyweakerversion
accurately.Clockdriftsratesaresmallinpractice(<0.02%undera calledLimitedHorizonResponseTimeFairness(LRTF)thatis
widerangeofscenarios[16]). stilluseful.Formally,LRTFisdefinedas,
In-orderdelivery:Weassumethatpacketscanbelostinthenet-
DEFINITION2. Asystemachieveslimited-horizonresponsetime
work. Packets that are not dropped are delivered in order. Just
fairnessifitsatisfiesthefollowingconditionforallcompetingspeed
likeexchangestoday,weassumethatalllosesarehandledout-of- trades(ğ‘–,ğ‘)and(ğ‘—,ğ‘)
bandwherethereceiverrequestsretransmissionusinganalternative
slower path [10]. Similar to modus operandi, our system incurs ğ¶2:ifğ‘‡ğ‘ƒ(ğ‘–,ğ‘)=ğ‘‡ğ‘ƒ(ğ‘—,ğ‘)=ğ‘¥
unfairnessinsuchcases. âˆ§ğ‘…ğ‘‡(ğ‘–,ğ‘) <ğ‘…ğ‘‡(ğ‘—,ğ‘),
Participantsarelocatedinthecloud:Weassumethatallthepartici- âˆ§ğ‘…ğ‘‡(ğ‘–,ğ‘) <ğ›¿,
pantsarelocatedinthecloud.Incaseacertainparticipantdoesnâ€™t
then,ğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘—,ğ‘).
wanttomovetothecloud,theexchangecanrunaproxymachinein
thecloudonthebehalfofsuchaparticipant.Externalparticipants Theaboveconditionissimilartocondition(C1)withanadditional
cangetmarketdatafeedandplacetradesthroughthisproxy.Because constraintthatthesystemguaranteesresponsetimefairnessforonly
ofadditionallatencyfromproxytotheparticipantmachines,trades fast trades that are generated within a bounded amount of time.
fromsuchexternalparticipantswillbeatadisadvantage.Fairness Noticethattheconstraintonresponsetimebeinglessthanğ›¿isonly
forotherparticipantsinthecloudremainsunaffected. onparticipantğ‘–.Participantğ‘–â€™stradeswillbeorderedfairlyregardless
Remark:CloudExalsomakesthesameassumptionsontrust,prox- ofwhethertheresponsetimeofotherparticipantsâ€™competingtrades
imity, and participants being in the cloud. The key difference is iswithinğ›¿ornot.Inthispaper,wewillpresentasystem,DBO,that
thatCloudExfurtherassumesclocksynchronizationandrequires foranygivenğ›¿achievesLRTFinaguaranteedmanner.
boundedlatencyforguaranteeingfairness. WhyisLRTFuseful?LRTFisbasedonthefactthattypicallypartici-
3.1 Challenges pantsrespondveryquicklytomarketdata.Fromourconversations,
thefasterparticipantsinmajorexchangesrespondswithinafewmi-
Therearethreekeychallenges.
croseconds.Studies[9]furthershowthatthemajorityofthespeed
Challenge1:Clock-synchronization.Ideally,wewantasolution
raceslast5-10microseconds.Anexchangeprovidercanchooseto
thatdoesnâ€™trequireanyclocksynchronization.
offeritsparticipantsguaranteedresponsetimefairnessforfasttrades.
Challenge2:Triggerpointisunknown.Weassumethattheex- Thechoiceofğ›¿presentsatrade-off;increasingğ›¿increasessystem
changecannottrustanMPtoaccuratelyprovidethetriggerpoint latency.
andthatthetriggerpointofaspeedtradeisnotknown.Insuchcase
Challenge3:Enforcingtheordering.Supposewecouldtageach
itishardtomeasuretheresponsetimeandconsequentlydecidehow
trade(ğ‘–,ğ‘)withtheordering(ğ‘‚(ğ‘–,ğ‘))inwhichwewantthetrades
tradesshouldbeordered.Unfortunately,whenresponsetimesare
tobeforwardedtotheCESforachievingfairness.Becausetrades
unboundeditisimpossibletoachieveResponseTimeFairness.
cantakeunboundedamountoftimeonthereversepath,eveninthis
THEOREM1. Iftriggerpointsfortradesareunknown,thenno scenarioitshardtoenforcesuchanorderingattheorderingbuffer.
systemcanachieveResponseTimeFairness. Inparticular,beforeforwardingtrade(ğ‘–,ğ‘)weneedtobesurethat
thereisnoothertrade(ğ‘—,ğ‘)inflightthatshouldbeorderedahead.
PROOF. Whentriggerpointsareunknown,theorderingenforced
4 Design
bythesystemshouldachieveresponsetimefairnessfortradesre-
gardlesswhatmighthavebeentheirtriggerpoint.Thismeansthat Inthissection,wewillfirstpresentthecoreofoursystem.Then
theorderingenforcedbythesystemshouldrespectconditionğ¶1â€² wepresentsomeanalysisofthesystemalongwithsomeextensions
regardlessofwhatthetriggerpointğ‘¥ is.Thenecessaryconditionfor toaddressafewpracticalconcerns.Wewillpresentdetailsofour
thistoholdtrueisgivenbelow. cloudimplementationseparatelyinthenextsection.
554

ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA E.Guptaetal.
x x + 1 S( j, b) < S(i, a)
CES G(x) G(x + 1) RT(i, a) < RT( j, b)
CES
D(i, x) t D(i, x + 1)
MP i RT(i, a)
RB
DC i D(i, x) S(i, a) D(i, x + 1)
i
ã€ˆx, 0ã€‰ ã€ˆx, t â€“ D(i, x)ã€‰ ã€ˆx + 1, 0ã€‰ RT( j, b)
RB
Figure4:DeliveryClock. j D( j, x) S( j, b) D( j, x + 1)
4.1 DeliveryBasedOrdering Figure5:DBOcanhelpcorrectforlatedeliveryofdata.Deliveryof
Oursolutioniscomposedofthreeparts.
marketdatatoMPğ‘–islaggingbehindMPğ‘—.Therearetwotrades(ğ‘–,ğ‘)
and(ğ‘—,ğ‘)generatedinresponsetothesamemarketdatağ‘¥.(ğ‘—,ğ‘)was
4.1.1 DeliveryClock submittedbefore(ğ‘–,ğ‘)butresponsetimeof(ğ‘–,ğ‘)islessthan(ğ‘—,ğ‘).In
Whatwedo.EachRBmaintainsaDeliveryClock.Thisdelivery thisexample,ğ·ğ¶(ğ‘–,ğ‘)(= âŸ¨ğ‘¥,ğ‘…ğ‘‡(ğ‘–,ğ‘)âŸ©) < ğ·ğ¶(ğ‘—,ğ‘)(= âŸ¨ğ‘¥,ğ‘…ğ‘‡(ğ‘—,ğ‘)âŸ©)
clockessentiallytrackstimerelativetowhenmarketdatawasdeliv- andtrade(ğ‘–,ğ‘)iscorrectlyorderedaheadof(ğ‘—,ğ‘).
eredtotheparticipant.Weuseğ·ğ¶(ğ‘–,ğ‘)torepresentdeliveryclock
ofparticipantğ‘– attimewhenatrade (ğ‘–,ğ‘) issubmitted.Delivery pacingdataattheRBitisindeedpossibletoensurethattheabove
clockisalexicographicaltuple. condition is always met. The main reason why we can meet the
ğ·ğ¶(ğ‘–,ğ‘)=âŸ¨ğ‘™ğ‘‘(ğ‘–,ğ‘),ğ‘†(ğ‘–,ğ‘)âˆ’ğ·(ğ‘–,ğ‘™ğ‘‘(ğ‘–,ğ‘))âŸ©. (5) aboveconditionisthatconditionC2limitsthatthetriggerpointğ‘¥
cannotbeanyarbitrarydatapointinthepast,andthatthetrigger
whereğ‘™ğ‘‘(ğ‘–,ğ‘)isthelatestdatapointthatwasdeliveredtoMPğ‘– by pointmusthavebeendeliveredrecentlyğ‘†(ğ‘–,ğ‘)âˆ’ğ·(ğ‘–,ğ‘¥) <ğ›¿.Inthe
timeğ‘†(ğ‘–,ğ‘),i.e.,ğ·(ğ‘–,ğ‘™ğ‘‘(ğ‘–,ğ‘)) â‰¤ğ‘†(ğ‘–,ğ‘) <ğ·(ğ‘–,ğ‘™ğ‘‘(ğ‘–,ğ‘)+1)).Interval,
nextsubsection,wewillshowhowwecanachievethisandsolve
ğ‘†(ğ‘–,ğ‘)âˆ’ğ·(ğ‘–,ğ‘™ğ‘‘(ğ‘–,ğ‘)),correspondstothetimethathaselapsedsince
challenge2.
the last delivery and can be measured locally at the RB without
Remark:Inourcloudexperiments,wefindthatusingdeliveryclocks
requiringanyclocksynchronization(Challenge1).Figure4shows
aloneforordering(i.e.,withoutanyadditionalcontroloverdelivery
howdeliveryclockadvanceswithtime.3
timesattheRB)achievesfairnesswithveryhighprobability.This
Monotonicity:Deliveryclocksadvancemonotonicallywithmarket
is because network latency (from CES to any given participant)
datadeliveryandrealtime.Asaresult,DBOtriviallysatisfiesthe
exhibitshightemporalcorrelationinlatencyespeciallyovershort
causalitycondition(Equation4).Further,itincentivizesthepartici-
periodsoftime.Whentemporalcorrelationishigh,inter-delivery
pantstosubmittradesasearlyaspossible.Therefore,aparticipant
timeatanyparticipantisclosetotheinter-generationtimeatthe
cannot gain any advantage by delaying trades. Finally, we also
CES.Insuchcases,conditiongivenbyEquation7issatisfiedwith
leveragethemonotonicpropertytoovercomechallenge3(Â§4.1.3).
highprobability.
Allincomingtradesaremarkedwiththedeliveryclockatthe
Differencewithtraditionallogicalclocks:Logicalclocksarecom-
tradesubmissiontime.Theorderingbufferusesthisdeliveryclock
monlyusedindistributedsystems.ThemostfamousonesareLam-
timetoordertrades.Formally,theorderinginDBOisgivenby,
portclocks[15]andvectorclocks.Theseclockscanbeusedfor
ğ‘‚(ğ‘–,ğ‘)=ğ·ğ¶(ğ‘–,ğ‘). (6) achievingcausalorderingofevents.Whiletheseclockscantrack
causalityofevents,theycannotbeusedtoachieveresponsetime
Whyitworks.Whenthetriggerpointoftrade(ğ‘–,ğ‘)isindeedthe
fairness.Inparticular,theseclocksdonâ€™tsayanythingabouthowtwo
lastdatapoint(i.e.,ğ‘¥ = ğ‘‡ğ‘ƒ(ğ‘–,ğ‘) = ğ‘™ğ‘‘(ğ‘–,ğ‘)),then,DBOrespects
competingtradesgeneratedusingthesamemarketdatashouldbe
conditionC2forLRTF.Figure5showsanillustrativeexampleof
orderedasthesetwotradeshavenodirectcausalityrelation.Unlike
this.Thisisbecause,thedeliveryclockdirectlytrackstheresponse
deliveryclocks,suchlogicalclocksalsohavenonotionofmeasuring
time of (ğ‘–,ğ‘) in this case andğ‘‚(ğ‘–,ğ‘) = ğ·ğ¶(ğ‘–,ğ‘) = âŸ¨ğ‘¥,ğ‘…ğ‘‡(ğ‘–,ğ‘)âŸ©.
timebetweenoccurrencesoftwoevents.Measuringtimeinterval
Foracompetingtrade(ğ‘—,ğ‘)withhigherresponsetime,thedelivery
betweeneventsiscriticaltoachievefairnesssforexchanges.
clockattimeofsubmissionwilleitherreadğ‘‚(ğ‘—,ğ‘) = ğ·ğ¶(ğ‘—,ğ‘) =
âŸ¨ğ‘¥,ğ‘…ğ‘‡(ğ‘—,ğ‘)âŸ© (ifğ‘†(ğ‘—,ğ‘) < ğ·(ğ‘—,ğ‘¥ +1)) orğ·ğ¶(ğ‘—,ğ‘) = âŸ¨ğ‘¦,ğ‘†(ğ‘—,ğ‘) âˆ’ 4.1.2 BatchingandPacing
ğ·(ğ‘—,ğ‘¦)âŸ©withğ‘¦ >ğ‘¥.Inbothcases,ğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘—,ğ‘). Whatwedo.InDBO,theCESsplitsdataintobatches.Eachnew
At a high level, in our ordering we are correcting for latency batchcontainsalldatapointsintheduration (1+ğœ…)Â·ğ›¿ afterthe
differencesindatadeliverybyusingthedeliverytimeofthelastdata
previousbatch(ğœ… >0).Eachreleasebufferdeliversalldatapoints
point.Whenthelastdatapointisnotthetriggerpointfortrade(ğ‘–,ğ‘), inabatchatthesametime.Thereleasebufferdeliversbatchesas
DBOsatisfiestheLRTFconditionC2,ifthefollowingcondition quicklyaspossiblewhileensuringthatthetimebetweendeliveryof
holds,
twoconsecutivebatchesisatleastğ›¿.Figure6showsanillustration
ğ·(ğ‘–,ğ‘™ğ‘‘(ğ‘–,ğ‘))âˆ’ğ·(ğ‘–,ğ‘¥)=ğ·(ğ‘—,ğ‘™ğ‘‘(ğ‘–,ğ‘))âˆ’ğ·(ğ‘—,ğ‘¥), (7) ofbatching.Bothbatchingandpacingdelaythedeliverytimeofdata
points.Inthenextsubsectionwewillanalyzetheimpactofthetwo
where ğ‘¥ = ğ‘‡ğ‘ƒ(ğ‘–,ğ‘). While it is impossible to ensure that inter- onlatency.NotethatintheeventofqueuebuildupattheRB,since
deliverytimesremainthesameforallparticipantsforallpoints,by thebatchgenerationrate( 1 )isslowerthanthebatchdequeue
(1+ğœ…)Â·ğ›¿
3For simplicity of notation, we only defined delivery clock at the time of trade rate(1),thequeueattheRBeventuallygetsdrained(Â§4.2.1).
ğ›¿
submission. More generally, delivery clock for MPğ‘– at any time ğ‘¡ is given by Why it works. With batching and pacing, DBO achieves LRTF.
âŸ¨ğ‘™ğ‘‘(ğ‘–,ğ‘¡),ğ‘¡âˆ’ğ·(ğ‘–,ğ‘™ğ‘‘(ğ‘–,ğ‘¡))âŸ©,whereğ‘™ğ‘‘(ğ‘–,ğ‘¡)isthelatestdatapointdeliveredbefore
timeğ‘¡. In particular, consider a trade (ğ‘–,ğ‘) with response time less than
555

DBO:FairnessforCloud-HostedFinancialExchanges ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA
(1+ )Â·Î´ (1+ )Â·Î´ (1+ )Â·Î´ trades (ğ‘—,ğ‘) withlowerresponsetimes(ğ‘…ğ‘‡(ğ‘—,ğ‘) < ğ‘…ğ‘‡(ğ‘–,ğ‘)).Let
ğ‘…(ğ‘–,ğ‘¥,ğ‘…ğ‘‡)representthetimewhentheCESwillreceiveapotential
CES ğœ… ğœ… ğœ…
trade (ğ‘–,ğ‘) whosetriggerpointisğ‘¥ andresponsetimeisğ‘…ğ‘‡.For-
RB mally,theearliesttimethattrade(ğ‘–,ğ‘)canbeforwarded,ğ¹ ğ‘šğ‘–ğ‘›(ğ‘–,ğ‘),
i
isgivenby,
MP
i ğ¹ ğ‘šğ‘–ğ‘›(ğ‘–,ğ‘)=max(ğ‘…(ğ‘—,ğ‘¥ =ğ‘‡ğ‘ƒ(ğ‘–,ğ‘),ğ‘…ğ‘‡ =ğ‘…ğ‘‡(ğ‘–,ğ‘))). (9)
â‰¥ Î´ â‰¥ Î´ ğ‘—
Figure 6: Batching and Pacing. Inter-delivery time for consecutive A subtle point to note here is that even if participant ğ‘— does not
batchesisequaltoormorethanğ›¿.
produce any trades, we still need to wait for that participant till
ğ›¿. Because of pacing, consecutive batches are separated at least ğ‘…(ğ‘—,ğ‘¥ = ğ‘‡ğ‘ƒ(ğ‘–,ğ‘),ğ‘…ğ‘‡(ğ‘–,ğ‘)). Before this time, fundamentally the
by ğ›¿. This means that the trigger point (ğ‘¥ = ğ‘‡ğ‘ƒ(ğ‘–,ğ‘)) must be CEScannotbesurethatitwillnotreceiveacompetingtradefrom
within the last received batch. The point ğ‘™ğ‘‘(ğ‘–,ğ‘) is also the last participantğ‘— withalowerresponsetime.
pointinthisbatchandğ·(ğ‘–,ğ‘™ğ‘‘(ğ‘–,ğ‘)) = ğ·(ğ‘–,ğ‘¥).Withbatchingand Weuseğ‘…ğ‘‡ğ‘‡(ğ‘–,ğ‘¥,ğ‘…ğ‘‡)torepresentthesumofrawnetworklatency
pacing,thedeliveryclockagaindirectlytrackstheresponsetime forpointğ‘¥ fromCEStoMPğ‘– andlatencyoftradefromMPğ‘– tothe
of (ğ‘–,ğ‘) andğ‘‚(ğ‘–,ğ‘) = ğ·ğ¶(ğ‘–,ğ‘) = âŸ¨ğ‘™ğ‘‘(ğ‘–,ğ‘),ğ‘…ğ‘‡(ğ‘–,ğ‘)âŸ©. With batch- CES(whosetriggerpointisğ‘¥ andresponsetimeğ‘…ğ‘‡).Inthebest
ing,forparticipant ğ‘—,ğ‘¥ andğ‘™ğ‘‘(ğ‘–,ğ‘) alsobelongtothesamebatch casescenarioforlatency(nobufferingatanypointinthepath),the
ğ·(ğ‘—,ğ‘™ğ‘‘(ğ‘–,ğ‘)) = ğ·(ğ‘—,ğ‘¥). For a competing trade (ğ‘—,ğ‘) with higher minimumvalueforğ‘…canbegivenby,
response time, the delivery clock at the time of submission will ğ‘… ğ‘šğ‘–ğ‘›(ğ‘–,ğ‘¥,ğ‘…ğ‘‡)=ğº(ğ‘¥)+ğ‘…ğ‘‡ğ‘‡(ğ‘–,ğ‘¥,ğ‘…ğ‘‡)+ğ‘…ğ‘‡. (10)
eitherreadğ‘‚(ğ‘—,ğ‘) =ğ·ğ¶(ğ‘—,ğ‘)) = âŸ¨ğ‘™ğ‘‘(ğ‘–,ğ‘)),ğ‘…ğ‘‡(ğ‘—,ğ‘)âŸ©(if(ğ‘—,ğ‘)was
Using the above three equations, we can write the following
submittedbeforethenextbatch,i.e.,ğ‘†(ğ‘—,ğ‘) <ğ·(ğ‘—,ğ‘™ğ‘‘(ğ‘–,ğ‘)+1))or
theorem.
ğ·ğ¶(ğ‘—,ğ‘) = âŸ¨ğ‘¦,ğ‘†(ğ‘—,ğ‘) âˆ’ğ·(ğ‘—,ğ‘¦)âŸ© withğ‘¦ > ğ‘™ğ‘‘(ğ‘–,ğ‘). In both cases,
ğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘—,ğ‘). THEOREM3. Foranysystemthatachievesresponsetimefairness,
4.1.3 Enforcingtheordering
theminimumlatencyfortrade(ğ‘–,ğ‘),ğ¿ ğ‘šğ‘–ğ‘›(ğ‘–,ğ‘),isgivenby,
OBcontainsapriorityqueuewhereallincomingtradesaresorted ğ¿ ğ‘šğ‘–ğ‘›(ğ‘–,ğ‘)=max(ğ‘…ğ‘‡ğ‘‡(ğ‘—,ğ‘¥ =ğ‘‡ğ‘ƒ(ğ‘–,ğ‘),ğ‘…ğ‘‡ =ğ‘…ğ‘‡(ğ‘–,ğ‘))). (11)
ğ‘—
basedonthedeliveryclocktimestamp(Equation6).Atrade(ğ‘–,ğ‘)
Putitsimply,theabovetheoremstatesforachievingresponsetime
attheheadofthepriorityqueueshouldbeforwardedtotheCES
fairness,theminimumlatencyisboundedbythemaximumround
onlywhentheOBhasreceivedalltrades(ğ‘—,ğ‘)withlowerordering
triptimeacrossallparticipants.Thismeansthatfundamentallybad
ğ·ğ¶(ğ‘—,ğ‘) <ğ·ğ¶(ğ‘–,ğ‘).
latencyforaparticipantaffectsthelatencyofalltrades.Toachieve
OBâ€™sHeartbeatHandler:InDBO,eachRBsendsaheartbeatpe-
lowlatencyconsistently,wewouldliketoensurethatlatencyofall
riodicallyeveryğœ secondstotheCES.Theheartbeat (ğ‘–,â„),from
theparticipantsiswellbehavedmajorityofthetimes.Howtobetter
participantğ‘– containsthedeliveryclocktimestampatthetimethe
achievethisgoalisleftasasubjectforfuturework.
heartbeatwasgenerated(ğ·ğ¶(ğ‘–,â„)).Sincedataisdeliveredinorder
HowdoesDBOcomparewiththelatencybound?DBOachieves
andbecausedeliveryclockadvancesmonotonicallywithtime,heart-
closetooptimallatency.Comparedtothelatencybound,batching
beat(ğ‘–,â„)tellstheOBthatithasreceivedalltradesfromparticipantğ‘–
andpacingintroduceadditionaldelayindeliveryofmarketdata
withdeliveryclocklessthanğ·ğ¶(ğ‘–,â„).Theorderingbufferforwards
points.Sinceheartbeatsaregeneratedonlyperiodicallytheycan
trade(ğ‘–,ğ‘)ifithasreceivedheartbeatsfromalltheparticipantswith
introduceanadditionaldelayofğœ attheorderingbuffer.Wenow
deliveryclocktimestamphigherthanğ·ğ¶(ğ‘–,ğ‘).
discussthedelayduetoeachofthesecomponentsandhowdothe
Note:Severalmajorfinancialexchangesalreadyrelyonheartbeats[2]
parametersğœ…,ğ›¿andğœ affectlatency.
forlivenesswhentrafficislow.
Impactofbatching:Batchingcanintroduceanadditionaldelayof
4.2 UnderstandingDBO
(1+ğœ…)Â·ğ›¿intheworstcase.
4.2.1 Latency,parametersettingandstragglermitigation Settingğ›¿:ğ›¿ thuspresentsatrade-offbetweenlatencyandfairness
Wewillfirstderivetheminimumlatencyrequiredbyanysystem (how large of a horizon can we pick). The right trade-off really
thatachievesresponsetimefairness.WewillthendiscusshowDBO dependsontheneedsoftheexchange.Ideally,theexchangeshould
comparestothislatencybound.Wewillalsopresentguidelinesfor picktheminimumvalueofğ›¿thataccommodatestheresponsetime
settingparametersandhowtomitigatestragglersthatcanimpact ofthefastestparticipantsinarace.Ourconversationsrevealthat
latency. fastestparticipantstypicallyrespondwithinafewmicrosecondsand
Wedefinelatencyfortrade(ğ‘–,ğ‘),ğ¿(ğ‘–,ğ‘),asthesumoflatencyin majorityofthespeedraceslast5-10ğœ‡ğ‘ .Forourcloudexperiments
deliveringdata(fromgenerationtime)andlatencyintradeforward- weuseğ›¿ =20ğœ‡ğ‘ .
ingtotheCES(fromtradesubmissiontime).Formally,
Impactofpacing. Pacingrestrictsthebatchdequeuerateatthe
ğ¿(ğ‘–,ğ‘)=(ğ·(ğ‘–,ğ‘¥)âˆ’ğº(ğ‘¥))+(ğ¹(ğ‘–,ğ‘)âˆ’ğ‘†(ğ‘–,ğ‘)), RB.Whennetworklatencytoaparticipantisnotvarying,thebatch
arrival/enqueue rate at the RB ( 1 ) is lower than the batch
ğ¿(ğ‘–,ğ‘)=ğ¹(ğ‘–,ğ‘)âˆ’ğº(ğ‘¥)âˆ’ğ‘…ğ‘‡(ğ‘–,ğ‘), (8) (1+ğœ…)Â·ğ›¿
dequeue rate limit (1) and there is no queue build up. However,
whereğ‘¥ =ğ‘‡ğ‘ƒ(ğ‘–,ğ‘).
whennetworklatenc
ğ›¿
ytoaparticipantisdecreasing(e.g.,aftera
LatencyBound:Formally,trade(ğ‘–,ğ‘)canonlybeforwardedtothe latencyspike),batcharrivalrateattheRBcanexceedthedequeue
CESâ€™sMEonlywhentheCEShasreceivedallpotentialcompeting ratelimitleadingtoaqueuebuildup.Theoverallqueue-dequeue
556

ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA E.Guptaetal.
Generation Time, G(x)
tnapicitrap
ot
ycnetaL
)x(G-)x,i(D
ofcrashes,OBmightnothearanyheartbeats.IftheOBdoesnot
Direct Delivery
Batching + Pacing hearaheartbeatfromaparticularparticipantfortheabovethreshold,
thenitconcludesthatroundtriplatencyexceedsthethresholdand
theOBdeemstheparticipantastraggler.
OBfailure:Intheevent,theOBcrashesalltradesinthepriority
queuewillbelost.Systemwillincurunfairnessinsuchcases.
4.2.2 Thenecessityofbatchingandpacing
Batchingandpacingcontributedelays;aretheynecessary?The
Figure7:Latencyindatadelivery:x-axisshowsthegenerationtimeof answerisyes.SimilartoLemma2,wecanderivethenecessary
themarketdata.y-axisshowsthelatencyfromgenerationtimetodata conditionsforachievingLRTF.
delivery.ğœ…governstheaverageslopeoftheorangelineimmediatelyafter
latencyspike(slope=
1+
ğœ… ğœ…). COROLLARY1. Whentriggerpointsareunknown,thenecessary
conditionsonthedeliveryprocessesforachievinglimitedhorizon
ratecanbegivenbybatchsizeÂ·batchratelimit = 1+ğœ….Figure7
responsetimefairnessisgivenby,
showstheimpactofbatchingandpacingonlatencyindeliveryof
Ifğ·(ğ‘–,ğ‘¦)âˆ’ğ·(ğ‘–,ğ‘¥) <ğ›¿, then,
data in the event of a queue build up. The figure also shows the
latencywhendataisdelivereddirectly(rawnetworklatency).The ğ·(ğ‘–,ğ‘¦)âˆ’ğ·(ğ‘–,ğ‘¥)=ğ·(ğ‘—,ğ‘¦)âˆ’ğ·(ğ‘—,ğ‘¥), âˆ€ğ‘–,ğ‘—.
smallersawtoothsinthebatching+pacingarebecauseofbatching.
PROOF. PleaseseeAppendixB. â–¡
Thedeviationindirectdeliveryandbatching+pacing(afterthe
latencyspike)isbecauseoftheratelimitimposedbypacing. IncontrasttoLemma2,theaboveconditionstatesthattheinter-
deliverytimeoftwopointsshouldbesameacrossallparticipants
Settingğœ…:Increasingğœ…increasesbatchingdelaybutalsoincreases
onlyiftheyareseparatedbylessthanğ›¿forsomeparticipant.Batch-
thequeuedrainrateintheeventofqueuebuildupduetotaillatency
ingandpacingindeedsatisfiesthis,fortwopointsğ‘¥andğ‘¦inabatch,
spikes.Increasingğœ…thuspresentsatrade-offbetweenreducingtail
theinter-deliverytimesacrossallparticipantsisindeedzeroand
latencyandincreasingaveragelatency.Inourexperimentsweuse
henceequal.Forpointğ‘¥ andğ‘¦belongingtodifferentbatches,since
ğœ… =0.25.
theinter-deliverytimeisgreaterthanğ›¿acrossallparticipants,there
Impactofheartbeats:Heartbeatspresentatrade-offaswell.Too isnoadditionalconstraintoninter-deliverytimesbeingequal.
frequentheartbeatscanoverwhelmthenetwork,theorderingbuffer
4.2.3 ImpactofRBtoMPlatency
orthereleasebuffer.InfrequentheartbeatscanincreasethetimeOB
InscenarioswhereRBandtheparticipantcannotbecolocated,DBO
hastowaitfortheparticipants.Inparticular,heartbeatscanintroduce
canincurunfairness.Ifthislatencyisunbounded,then,itmightbe
anadditionalwaittimeofğœ.Notethatthenumberofheartbeats,the
impossibletoachievefairness.Iflatencyisbounded,however,then
OBneedstoprocessincreaseslinearlywiththenumberofpartici-
DBOprovidesthefollowingfairnessguarantees.
pants.Inthenextsectionweshowhowtheheartbeathandlercanbe
shardedforscalability. THEOREM4. Ifroundtripnetworklatencyfromreleasebuffer
Settingğœ: Ideally we want to pick as low of a value as possible ğ‘– toitâ€™scorrespondingparticipantisboundedbetweenğµ ğ‘™(ğ‘–) and
fortheheartbeatswithoutoverwhelmingthesystem.Thisnumber
ğµ â„(ğ‘–), then, DBO achieves the following guarantee for ordering
trades.
isverymuchdependentonthecapabilitiesofthenetworkandthe
processingpoweroftheRBandtheOB.Inourcloudimplementation
ğ¶3:ifğ‘‡ğ‘ƒ(ğ‘–,ğ‘)=ğ‘‡ğ‘ƒ(ğ‘—,ğ‘)=ğ‘¥
weuseğœ =20ğœ‡ğ‘ . âˆ§ğ‘…ğ‘‡(ğ‘–,ğ‘) <ğ‘…ğ‘‡(ğ‘—,ğ‘)âˆ’(ğµ â„(ğ‘–)âˆ’ğµ ğ‘™(ğ‘—)),
Anoteonlatency:Whenthenetworklatencytoparticipantsisnot âˆ§ğ‘…ğ‘‡(ğ‘–,ğ‘) <ğ›¿âˆ’ğµ â„(ğ‘–),
varyingwithtime,thereisnoqueuebuildupatthereleasebuffers. then,ğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘—,ğ‘).
Insuchcases,DBOaddsmaximumof((1+ğœ…)Â·ğ›¿)+ğœ additional
PROOF. SeeAppendixC. â–¡
latencyoverthelatencybound.
StragglerMitigationandRB/MPfailureIntheeventaparticipant ComparedtoLRTF,theaboveconditionreducestheboundon
orreleasebuffercrashes,DBOcanstallprocessingtrades.Further,
responsetimeforthefastertrade(ğ‘–,ğ‘)toğ›¿âˆ’ğµ â„(ğ‘–).Additionally,the
theoverallsystemlatencyalsogetsimpactedwhenacertainpartici- aboveconditionstatesthattradesareorderedfairlyonlywhenthe
pantisexperiencingunusuallyhighnetworklatency(seeTheorem3). responsetimeofthefastertradeislowerthantheresponsetimeofthe
Herewehavetheoptiontowaitforthedelayedparticipantandtake
competingtradebyatleastthevariabilityinlatency(ğµ â„(ğ‘–)âˆ’ğµ ğ‘™(ğ‘—)).
alatencyhitbutnotletthefairnessbeimpacted.Ideally,wewant This theorem essentially states that when RB and MP cannot be
toletthesystemcontinuewithlowlatencywithonlytheaffected colocated,forbetterfairnessweshouldensurethatlatencybetween
participantincurringunfairness.InDBO,weuseasimplestrategy themisbothconsistent(acrossparticipants)andtheupperboundis
tomitigatethis.Usingtheheartbeatsandthegenerationtimeofdata small.
points,theOBtrackstheroundtriplatencytoeachparticipant.If 4.2.4 ImpactofLosses
thislatencygoesbeyondacertainthresholdforaparticipant,then Althoughinfrequent,packetlossescanoccurincloudenvironments.
theOBdoesnotwaitforheartbeatsfromsuchstragglerparticipant SuchlossescanimpactfairnessinDBO.However,onlythefairness
beforeforwardingtrades.Whentheroundtriplatencygoesdown, fortradesthatarelostandpotentialtradeswhosetriggerpointislost
OBagainstartswaitingforheartbeatsfromthestraggler.Intheevent areimpacted(seeAppendixD).
557

DBO:FairnessforCloud-HostedFinancialExchanges ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA
4.2.5 Thwartingfront-runningattacks Set (on delivery):
Thereisafront-runningattackpossibleinoursystem.Inparticular, RX Network Jitter i t d latest = pk t = .m c a lo r c ke k( t ) _id Paced data
ifaparticipantreceivesamarketdatapointğ‘¥ throughsomeother latest_delivery
way before RB delivers the data pointğ‘¥ to the participant, then
theparticipanthasacompetitiveadvantage.Thisscenario(though
unlikely)isstillpossible.
Asimplewaytoavoidthisistolimitthataparticipantcannottalk
toanyonebeyondtheCES.However,wewouldliketheparticipant
machinetouseotherâ€œhelperâ€machinesinthecloud,e.g.,toaid
computation.Wealsowanttoallowtheparticipantstobeableto
talktomachinesoutsidethecloud,e.g.,togetanewsstream.
In Appendix E, we show how we can prevent such front run-
ningattacks.Inoursolution,theparticipantanditshelperscannot
communicatewithanyotherparticipantsortheirhelpersusingthe
cloudnetwork.Topreventscenarioswhereaparticipantusesaproxy
machineoutsidethecloudtosendmarketdatatootherparticipants
(fasterthanthenetwork),wepreciselyaddadditionallatencyfordata
beingsentoutsidethecloud.Whileoursolutionintroduceslatency
fordatagoingout,thelatencyofspeedtradesremainsunaffected.
4.2.6 FutureWork:FairnessbeyondLRTF
WithDBO,itisnotguaranteedthattradesthatdonotdirectlyfollow
the LRTF model (Theorem 1 and Equation 1) are ordered fairly.
However,DBOstillensuresfairnessforthemostlatency-sensitive
speedtrades.Whileensuringguaranteedfairnessfortradesthatdo
notfollowthemodelmightbeimpossible,wediscusssomepotential
solutions.
Tradeswithresponsetime>ğ›¿:DBOdoesnotprovideanyguar-
anteesfortradeswithresponsetimegreaterthanğ›¿.Incasewehave
access to synchronized clocks, we can try and ensure (to the ex-
tent possible) that batches are indeed delivered at the same time
acrossparticipants.Whenbatchesaredeliveredsimultaneously,de-
liveryclocksalsogetsynchronizedandDBOsimplyorderstradesin
theorderofsubmissiontime.DBOthusensuresbetterfairnessfor
suchtrades(whendataisdeliveredsimultaneously)whilealways
guaranteeingLRTF.Thatsaid,inourcloudexperiments(Â§6.3.2),
becauseoftemporalcorrelationinlatency,DBOalone(withoutany
synchronizedclocks)providesfairnessforsuchtradeswithhigh
probability.
Generalizedcomputemodelfortrades:Atradeâ€™ssubmissiontime
mightbegovernedbydeliverytimesofmultipledatapoints.Again
insuchcasesifwehaveaccesstosynchronizedclocks,wecantry
andensuresimultaneousdeliverytotheextentpossibleandachieve
betterfairnessforsuchtrades.
Externaldatastreams:Intheory,externaldatastreamslikenews
eventsormarketdatafromacompetingexchangecantriggerspeed
races.WhileDBOdoesnotdelaydeliveryofsuchstreamstothe
participants(AppendixE),asdescribeditdoesnotguaranteefair-
nesswithrespecttosuchstreams.Existingexchangesdonotprovide
anysimultaneousdeliveryguaranteeswithrespecttosuchexternal
streams.Suchstreamstypicallytraversetheinternet,andthevariabil-
ityinnetworklatencyissubstantiallyhigher(orderofmilliseconds)
thanthemarketdatastream(orderofmicroseconds).Potentially,
theexchangecanserializesuchexternalstreamswiththemarket
datastreamandensureLRTFwithrespecttosuchasuperstream.
Suchaserializationmightnotbetrivial.Differentparticipantsmight
(MP) Host RB context:
{ id , t }
latest latest_delivery
TX Tag:
DC DC = { id latest , clock() - t latest_delivery }
MP trades
SEC
â‰¥ Î´ â‰¥ Î´
Figure8:High-levelarchitectureoftheReleaseBuffer.TheDelivery
ClockadvancesuponnewmarketdatareceptionfromtheCES.Incom-
ingtradesfromtheMParetaggedwiththeDeliveryClockidandMPâ€™s
responsetimebeforebeingsenttotheOB/CES.
requestdifferentexternaldatastreams.Furtherthoughtisrequired
onwhatconstitutesafairserialization.
5 CloudArchitectureandImplementation
Inatypicalon-premisedeployment,theCESserversandphysical
networkarepartofthetrustedinfrastructureoftheexchange:the
exchangeoperatorshaveexclusiveaccesstothephysicalmachines,
networkelementsandcables.Ontheotherhand,theMPsownthe
physicalserversthatconnecttotheexchangenetwork.Migrating
suchcomponentstothepubliccloudisslightlymorecomplicated:
whiletheCESserversandMPscouldbeaccommodatedbyvirtual
machines owned by the different parties, the network infrastruc-
tureisstillownedbythecloudprovider.Furthermore,comparedto
on-premisedeployments,DBOrequiresleveragingtwoextracom-
ponentsforcorrectness:theReleaseBuffer(RB)andtheOrdering
Buffer(OB).
5.1 ReleaseBuffer
Figure8depictsahigh-levelviewoftheRBâ€™sfunctionality.The
RBtransparentlyinterposesthecommunicationbetweentheMar-
ketParticipant(MP)andtheOrderingBuffer(OB).Asmentioned
previously,theRBmaintainstheDeliveryClock(DC),thelogical
clocktupleconsistingofidofthelatestdatapointtransmittedtothe
MPandthetimeelapsedsincethelasttransmission.Marketdata
aregroupedintologicalbatchesbytheCESandsenttoeachMP.
TheRBbuffersthereceivedmarketdata(packets)thatbelongtothe
samebatch,untilthefullbatchisreceived.Uponthereceptionof
thelastmarketdata(packet)ofthebatch,theRBchecksthetime
elapsedsincethepreviousmarketdatabatchdeliverytotheMP:
ifitisequaltoormorethanğ›¿,thebatchisreleasedtotheMPat
once,andtheDCisupdatedontransmissioncompletionofeach
packet.Otherwise,thebatchisbufferedattheRBfortheappropriate
durationtoensurethatinter-batchgapisequaltoormorethanğ›¿.
EachMPimplementsitsownstrategyonhowtorespondtoeach
marketdatareceived,andgeneratestrades.Allthetradesfroman
MPareinterceptedbythecorrespondingRB:uponthereception
ofatrade,theRBneedstotagthetradeaccordinglywithaDC-
derived timestamp so that total ordering can be achieved at the
OrderingBuffer.Thistimestampispiggybackedoneachtradeand
iscalculatedsimplyasthetupleconsistingofthecurrentDCidand
therealtimeelapsedbetweentradereceptionandlatestmarketdata
delivery.
Where should the RB be placed in a cloud-hosted Financial Ex-
changedeployment?Therearetwoessentialrequirementsforthe
RBcomponent:(a)thelatencybetweenMPandRBmustbeminimal
558

ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA E.Guptaetal.
sothatitdoesnotaffectcorrectness,and(b)forsecurityreasons,the
CES VM MP VM
RBmustbeisolatedfromtheMP,toavoidattacksthataimtotamper
withresponsetimemeasurementsormarketdatadelivery.Deploying Execution
OB ME
theRBasastandaloneVMisnotasolution,asthatwouldintroduce Engine
non-negligible,variablelatencybetweenMPandRB.EvenforVMs
thatarecollocatedintothesamephysicalnode,inter-VMcommuni- RX TX RX TX
cationisstillachievedviathenetworksothatcloudproviderscan
vNIC RB vNIC
enforcetheappropriateSDNpolicy.Aswitch-basedimplementa-
tionwouldalsosufferfromsimilarlimitations:(a)thereislackof
fine-grainedcontrolforVMplacementincloud(sowecannothave
anyguaranteesaboutswitch-VMlatencies),(b)switchresourcesare
Figure9:Cloud-hostedexchangesâ€™architecturalview.
scarceandsharedbymultitenanttrafficinthecloud,andavoiding
deployedeitherasdifferentthreadsonmulticoreCPUsorevenas
interferencewouldbeachallengingproblemtosolve.
standaloneVMs.EachOBneedstoberesponsibleforasubsetof
Top-tiercloudprovidersdeploy(custom)programmableNICs
theRBs.TheOBinstancescandequeueabatchofpendingtrades
thatleverageavarietyofASIC-orFPGA-basedacceleratorsand
whensafeandsendthemtoME-colocatedOBforthefinalmerge
powerfulSoCstoenforcestrictSDNpoliciesrequiredforI/Ore-
beforetheyareforwardedtothematchingengine.AdistributedOB
sourcemanagement,networkvirtualization,billingetc.Theseplat-
deploymentwouldalsoallowhandlingthehigherratesofheartbeats
formsserveasanaturalboundarybetweentheguestVMsthatare
inthecaseofnumerousMPs,aseachOBcaneffectivelyfilteroutall
controlledbythecustomersandthedatacenternetworkwhichis
incomingheartbeatsbeforereachingtheCES.EachdistributedOB
shared resource managed by the cloud operator. We believe that
instanceneedstomaintaintheminimumofcurrentDeliveryClocks
theRBâ€™sfunctionalityshouldbeembeddedinthecloudprovidersâ€™
fromitsassociatedRBs,whilethemasterOBneedstomaintainthe
smartNICs.RBsupportintheprogrammableNICcouldbeincre-
minimumDCfromallthedistributedOBstobeabletodequeue
mentally deployed in the existing infrastructure, and exposed to
tradessafelytothematchingengine.Sincecontemporaryclouddata-
customersasavirtualNICfeaturesimilartoacceleratednetworking
centernetworksdonotsupportin-networkmulticastformarketdata
[5,6,12].NICperformanceisolationandbackgroundinterference
transmission,suchdistributedapproachwouldalsoallowscalingthe
challengesarebeyondthescopeofthispaper:MPsalreadyinvest
CESâ€™marketdatadistributionenginetohigherrates.
largeamountsofmoneyfortheirco-locatedserverhardwareâ€“using
high-endinstancesthatprovidesingle-tenancyguaranteespercloud 6 Evaluation
node[7,8]wouldeliminateinterferencestemmingfromon-host
Weevaluatethefeasibilityofoursolutioninhardwareusingour
multi-tenancy.
ownhardwaretestbed.Weusepublic-cloudexperimentstogetan
Sincewedonothaveaccesstocloudprovidersâ€™smartNICs,we
understandingofoverallDBOâ€™sperformanceintermsoflatencyand
usedanoff-the-shelfprogrammable(DPU)NIC[4]todemonstrate
fairnessifdeployed.
thefeasibilityofaNIC-basedRBimplementation.Weimplemented
6.1 Methodology
theRBfunctionalityontopofDPDK[1],runningitontheSystem-
on-ChipARMcores.Abusy-pollingreceiveengineinterceptsall For all of the experiments (except simulation) presented in this
incomingmarketdatatrafficandreleasesthemtothehostwhileen- section,weleverageourprototypeCESandMPimplementations.
forcingthepacingrequirements.TheRBfunctionalityiscompletely On the CES side, we generate and distribute data to all Market
transparentfortheMP:marketdatapacketsappearatthehostâ€™sRX Participantsatfixedintervals.Themarketdatapointsarriveatthe
ringunmodified. RBs,whichlateronreleasethemtotheMarketParticipants.The
MPimplementationreliesonbusy-pollingandkernel-bypassfor
5.2 OrderingBuffer
low-latencyaccesstotheincomingmarketdatapackets,butdoesnot
TheOrderingBuffercomponentâ€™sfunctionalitycloselyresembles
utilizeasophisticatedalgorithmfortradingdecisions;itratherbusy-
thatofaâ€˜sequencerâ€™whichtagsincomingtradesinaFirst-Come-
waitsforapre-configuredresponsetimedurationbeforegenerating
First-Served(FCFS)mannerinexistingon-premisedeployments.In
atrade.WeseteachMPâ€™sreactiontimeaccordinglysothatwecan
oursystem,itisresponsiblefororderingallreceivedtradesbased
derivetheexpectedfinalorderingattheOBandevaluatefairness.
ontheirDeliveryClocktimestamp,beforetheyaresubmittedtothe
Fairnessmetric:ForanynumberofMPs,perfectfairnessisachieved
MatchingEngine(ME).Similarlytotheâ€˜sequencerâ€™,theOBcompo-
whenallcompetingtradesamongalluniquepairsofparticipants
nentispartofthetrustedCESplatform.Inourprototypesystem,we
arefullyordered(fromfastertoslower).Wedefinethemetricof
haveimplementedtheOrderingBufferasadedicatedthreadwhich
fairnessastheratioofthenumberofcompetingtradesetsthatwere
buffersincomingtradesinapriorityqueue(forordering).When
orderedcorrectlytothetotalnumberofcompetingtradesetsforall
theOBhasreceivedallheartbeatsupuntilaparticularDC-derived
uniquepairsofmarketparticipants.
timestampitdequeuesalltherelevanttradestotheMatchingEngine
End-to-endlatency:Wedefineend-to-endlatencyofatradeusing
overshared-memorychannels. Equation 8 (ğ¹(ğ‘–,ğ‘) âˆ’ğº(ğ‘¥) âˆ’ğ‘…ğ‘‡(ğ‘–,ğ‘)). Generation time and for-
Scaling:WithhighernumbersofMPs,asingleOBinstancewould
wardingtimearemeasuredattheCES.Forthepurposeofreporting
becomethebottleneck(inaggregate,numberofheartbeatsscale
latencyandfairness(andnotfororderingtradesinDBO),weassume
linearlywithparticipants).Insuchcases,scalingtheOBisstraight-
thatthetriggerpointisknown.Weuseittocalculatetheresponse
forwardbyleveragingsharding:multipleOBcomponentscouldbe
timeoftradesatthereleasebuffer.Wealsoreportthelatencybound
559

DBO:FairnessforCloud-HostedFinancialExchanges ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA
Fairness Latency(ğœ‡ğ‘ ) Fairness Latency(ğœ‡ğ‘ )
(%) avg p50 p99 p999 (%) avg p50 p99 p999
Direct 74.62 9.60 9.52 16.58 25.25 Direct 57.61 27.9 27.48 32.5 44.03
Max-RTT - 10.23 9.94 18.08 26.18 Max-RTT - 33.34 32.44 42.01 48.38
DBO 100 15.92 12.16 28.82 46.80 DBO 100 47.19 46.95 55.71 67.41
Table2:Fairnessandtradelatencyresultsonbaremetalserverswith Table3:Fairnessandend-to-endlatencyfordifferentschemes;full
BlueField-basedRBimplementation. tracescollectedovera15-minuteduration.Forconsistency,Max-RTT
latencies(ğ¿ğ‘šğ‘–ğ‘›lowerbound)arecalculatedusingthepackettimestamps
(maximumnetworkround-trip-latencyacrossallparticipants,The-
fromtheDBOexperimenttrace.
orem3),shownasMax-RTT,forachievingperfectresponsetime
fairness. 1.0
Weevaluateoursolutiononthreedifferentsetups:(a)on-premise,
bare-metaltestbeddeployment,(b)public-cloud-baseddeployment, 0.5
and(c)simulation.
Evaluationschemes:Weevaluatethreeschemes.(1)Directde-
0.0
livery:Thisisthebaselinescheme.Thereisnoreleasebufferor 40 60 80 100 120 140
orderingbufferandbothtradesandmarketdatapointsjustincurthe Latency (Î¼s)
underlyingnetworklatency.(2)DBO:Basedonourdiscussionin
Â§4.2.1,weuseğ›¿ =20,ğœ… =0.25andğœ =20ğœ‡ğ‘ .(3)CloudEx:CloudEx
requiresfine-grainedclocksynchronization,whichisnotavailable
inourtest-bedandcloudexperiments.Duetoinaccuraciesinclock-
-synchronizationinourexperiments,weexperiencefrequentrelease
andorderingbufferoverruns.WeonlyreportresultsforCloudExin
simulationwhereweassumeperfectlysynchronizedclocks.
Response Time: The response time for each trade is a random
numberbetween5and20ğœ‡sandiswithinthehorizon(ğ›¿).Note
thatoursolutiondoesnotensurefairnessforspeedraceswherethe
responsetime(ofthefasterparticipant)isgreaterthanthehorizon.
Wepickedahorizontoaccommodatemajorityofthespeedraces.
Butweexplicitlytakeintoaccountthislimitation.Wepresentlatency
results with longer horizons and include experiments where the
responsetimeexceedsthehorizon.
6.2 EvalutiononDPU-enabledbaremetalservers
Ourlabsetupconsistsofthreemachines:oneCESserverandtwo
MPservers.TheCESserverisequippedwithanNvidiaConnectX-5
NIC with two 100Gbps ports. Each MP server hosts one Nvidia
BlueField-2DPUwithtwo100Gbpsports.Theserverhasadual-
CPUIntelXeonprocessorrunningat3.1GHz.EachBlueField-2
DPUhaseightARMv8A72cores.Allmachinesareconnectedvia
a100GbEswitch.WerunLinuxkernel(v5.4.0)andDPDK(v21.11)
fortheCES,RB,andMPnetworkengines.
The CES is generating market data every 40ğœ‡ğ‘  (25ğ¾ ticks per
second),andthemarketparticipantserversaregeneratingresponses
withinğ›¿ timehorizonsincethereceptionofthedata.TheRBis
executingontheBlueField-2DPUâ€™sSoC.
Table2showstheachievedfairnessandlatencyofoursystem.
Direct delivery achieves poor fairness because of differences in
networklatency.DBOachievesperfectfairnessatthecostoflatency.
Inparticular,toachieveresponsetimefairness,theOBwaitsfor
theslowestparticipant.ThelatencyislowerboundedbyMax-RTT
(Theorem3).ThedifferencebetweentheMax-RTTandDBOisdue
tobatching,pacingandheartbeats.
6.3 Cloud-hostedTestbed
We wish to understand how our system performs in a real pub-
lic cloud-based deployment with several market participants. As
discussed in Â§5.1, we do not have access to the cloud providersâ€™
programmableNICstodeploytheRBfunctionality.Toworkaround
FDC
DBO(20,25)
DBO(45,60)
DBO(80,120)
Max-RTT
Figure10:CDFsoftheend-to-endlatencyforvariousDBOconfigura-
tions.
thislimitation,wehaveadjustedourRBimplementationsothatit
runsasaco-locatedprocesswiththemarketparticipantâ€™sexecution
engineontheMPVMs.Insuchconfiguration,theRBisusinga
kernel-bypassnetworkstacktotakeoveradedicatedvNICwhich
it uses to receive the UDP stream of market data from the CES,
andtosendbackanytradessubmittedbytheMP.Tofacilitatefast
MP-to-RBcommunicationwerelyonshared-memory-basedIPC
primitives.Clearly,suchasolutiondoesnotprovideanysecurity
guaranteesastheRBsrunonVMsownedbythemarketparticipants
whicharenotpartoftheCESâ€™TrustedComputingBase,andcould
easilytamperwiththeRBâ€™smarketdatadeliveryengineorthede-
liveryclockmeasurements.Itallowsus,however,toevaluatethe
real-worldperformance(i.e.,achievablethroughputandlatency)of
ourDBOsysteminapublicclouddeployment.
Wesetouttoevaluatethefairnessandend-to-endlatencyofdif-
ferentschemes.WedeploytenmarketparticipantsandoneCESas
virtualmachines(Standard_F8s)inMicrosoftAzure.Weconfigure
theaggregateservicerateto125,000transactions(trades)persecond
(marketdatagenerationintervalisfixedto40ğœ‡ğ‘ ).Table3summa-
rizestheachievedfairnessandend-to-endlatencyresultsfordirect
deliveryandDBO.
Fairness:Directdeliveryachievespoorfairnessinourexperiments.
Comparedtoourtest-bedwherethereisnonetworktrafficandthe
variabilityinlatencyacrossparticipantsislower,directdeliveryper-
formsworseinthecloud.DBOalwaysachieveperfectfairness.We
discussfairnessforslowrespondersinÂ§6.3.2.
Latency:Asexpected,directdeliveryachievesthelowestlatency,
atthecostoffairness.Ontheotherhand,DBOtradesofflatency
to achieve perfect fairness, but it still achieves sub-100ğœ‡ğ‘  p999
tail latency in the public cloud. This latency is well within the
requirementsofmanymajorexchanges.IEX,forexample,amajor
exchangethatpridesitselfonfairnesshad700ğœ‡ğ‘  latency[3].We
believethatwithadditionaloptimizationssuchasnetworktraffic
prioritization,in-networkmulticast,proximityplacementgroups,
thisnumbercouldbefurtherbroughtdown.Thep9999latencyis
muchhigher(~3.5ms);fulltraceanalysisshowsthatpacketdroprate
isverylowbutweidentifiedawell-aligned,periodicqueuebuildup
attheOBwhichwebelieveisduetoschedulingartifactsintheVM.
560

ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA E.Guptaetal.
RT(inğœ‡ğ‘ ) 10-15 15-20 20-25 25-30 30-35 35-40
Direct 0.45 0.46 0.46 0.46 0.46 0.46
DBO 1.0 1.0 0.999 0.999 0.997 0.985
Table4:Fairnessfortradeswithresponsetime>ğ›¿=20.
600
400
200
0
0 250 500 750 1000 1250 1500 1750 2000
Time (ms)
)sÎ¼(
ycnetaL
60
40
20
0
10 30 50 70 90
# Participants
Figure11:Networktraceusedforsimulation.
6.3.1 UnderstandingDBOlatency:HowdoDBOparameters
affectend-to-endtradelatency?Figure10illustratestheCDFofthe
latencywithdifferentDBOconfigurations.Here,DBO(ğ‘¥,ğ‘¦)refers
tousingahorizonğ›¿ =ğ‘¥andbatchsize(1+ğœ…)Â·ğ›¿ =ğ‘¦.Wealsoinclude
theoptimallatencybound(Max-RTT).Asexpected,increasingthe
horizonandthebatchsizeincreasesthelatency.Whenbatchsize
is60ğœ‡sweseeoneinflectionpoint.Forbatchsizeof120ğœ‡ğ‘ wesee
twoinflectionpoints.Theseinflectionpointsareadirectresultof
batching.Sinceanewmarketdatapointisgeneratedevery40ğœ‡ğ‘ ,
forbatchsizeof60ğœ‡ğ‘ ,roughly2/3ofthebatchescontaintwodata
points. The first point in such batches incurs 40ğœ‡ğ‘  of additional
delay compared to the second point. This difference creates the
inflection point. Similarly for batch size 120ğœ‡ğ‘ , on average there
arethreemarketdatapoints,thefirstpointinthebatchincursan
additionaldelayof80ğœ‡ğ‘ whilethesecondpointincursanadditional
delay of 40ğœ‡ğ‘ . For batch size of 25ğœ‡ğ‘ , which contains only one
marketdatapoint,thebatchingdelayiszero.Thedeviationfromthe
optimallatencyboundisprimarilyduetoheartbeats.Recallwhen
network latency is well behaved, pacing does not add additional
delay.Sinceğœ =20,heartbeatscostanadditionallatencydelayof
10ğœ‡ğ‘ onaverage.
6.3.2 Tradeswithresponsetime>ğ›¿
DBOonlyguaranteesfairnessfortradeswithalimitedresponse
time.Table4showsthefairnessforsuchtradesfordifferentvalues
of response time. In each experiment, the response time for the
tradeisderivedfromarangeofvalues(shownonthetopofthe
table).Directdeliveryachievespoorfairness(similartoTable3).
In contrast, even though the response time of trades exceeds the
horizonğ›¿,DBOachievesclosetoidealfairness.DBOorderssuch
tradesfairly,iftheinter-deliverytimeforthebatchthattriggeredthe
tradeandthelastbatchcorrespondingtothetradeissameacrossall
participants.Inthecloudexperiments,eventhoughlatencydiffers
acrossparticipants,foranyparticularparticipant(majorityofthe
time)thelatencyexhibitslittlevariation.Figure11showstheend-
to-endnetworklatencyforaparticularparticipantinthisexperiment.
Asaresult,theinter-deliverytimeforbatchesissimilar(=(1+ğœ…)Â·
ğ›¿) across all participants for most of the time. DBO is thus able
tocorrectforstaticdifferencesinlatencyacrossparticipantsand
achievefairness.
6.4 Simulation
We use simulations to evaluate DBO as we scale the number of
participantsandtocomparewithCloudEx.Weuseanetworktrace
ofroundtriptimesbetweentheCESandanRBfromthecloud-
hostedtestbed,asillustratedinFigure11.Theone-waylatencies
betweenCESandeachRBarecalculatedbytakingrandomslices
)sÎ¼(
ycnetaL
DBO
300
200
100
0
10 30 50 70 90
# Participants
(a)Meanlatency
)sÎ¼(
ycnetaL
Max-RTT
(b)Taillatency(p99)
Figure12:Latencyasafunctionofthenumberofmarketparticipants.
1.000
0.999
0.998
0.997
0.996
0.995
0.994
0 200 400 600
Latency (Î¼s)
ssenriaF
1.000
0.999
0.998
CloudEx, 10 MPs 0.997
CloudEx, 60 MPs 0.996
DBO, 10 MPs
0.995
DBO, 60 MPs
0.994
0 200 400 600
Tail Latency p99 (Î¼s)
(a)Meanlatency
ssenriaF
CloudEx, 10 MPs
CloudEx, 60 MPs
DBO, 10 MPs
DBO, 60 MPs
(b)Taillatency(p99)
Figure13:CloudEx(perfectclock-synchronization)vsDBO.Wevary
theone-wayCloudExlatencythresholdsfrom15to290ğœ‡s.
ofthenetworktraceandhalvingtheRTTs.Theresponsetimesare
between5to20ğœ‡ğ‘ .
Scalingthenumberofparticipants.Figure12showsthemeanand
thetaillatency(p99)forDBOaswescalethenumberofparticipants.
We also include the latency bound (Max-RTT) in the figure for
reference.Asexpected,thelatencyboundincreaseswiththenumber
ofparticipants.Theend-to-endlatencyforDBOislimitedbythis
bound,withadditionaldelayduetobatching,pacingandheartbeats.
WethusseeasimilartrendasMax-RTTinthelatencyforDBO.
ComparisonwithCloudEx.Figure13showsthefairnessandend-
to-endlatencyofDBOandCloudEx(assumingperfectclocksyn-
chronization).Wereportresultsforscenarioswith10and60market
participantsrespectively.ForCloudEx,weusedifferentvaluesof
latencythresholds:asweincreasethelatencythresholds,fairness
improvesbutlatencydegrades.Here,CloudExachievesperfectfair-
ness only when the one-way latency threshold is set higher than
themaximumone-waylatencyvalueinthetrace.CloudExincurs
thishighlatencyatalltimes,evenwhentheunderlyingnetwork
latencyislow.Incontrast,inthecaseofDBO,aspikeinlatency
onlyoccurswhenthereisasurgeintheunderlyingnetworklatency.
DBOmaintainsperfectfairnessatareducedlatencycomparedto
CloudEx.
7 Conclusion
WepresentedDBO,anovelmechanismtoprovidefairnessforhigh
frequency trading in cloud environments. DBO is incrementally
deployable,achievesguaranteedfairnessandlowlatencywhilestill
operatingathightransactionrates.
Acknowledgements
WethankGrahamMosley,SadjadFouladi,MarkRussinovich,Anu-
pamPandey,RupeshKhendry,MarkGalgano,andAlanRoss.We
furtherthankRobertPark,andAlpeshSethiafortheirinsightful
feedbackonfinancialexchangearchitecturesandhigh-frequency
tradingworkloads.
Thisworkdoesnotraiseanyethicalconcerns.
561

DBO:FairnessforCloud-HostedFinancialExchanges ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA
References
[1] 2013.DataPlaneDevelopmentKit(DPDK). http://dpdk.org/
[2] 2017.NYSEXDPClientSpecification. https://www.nyse.com/publicdocs/nyse/
data/XDP_Common_Client_Specification_v2.1e.pdf
[3] 2019.TheCostOfExchangeServices. https://finansdanmark.dk/media/mstbpq23/
iex-and-market-data-cost-2019.pdf
[4] 2021. NVIDIA BlueField-2. https://www.nvidia.com/content/dam/en-zz/
Solutions/Data-Center/documents/datasheet-nvidia-bluefield-2-dpu.pdf
[5] 2023. AmazonAWSElasticFabricAdapter. https://docs.aws.amazon.com/
AWSEC2/latest/UserGuide/efa.html
[6] 2023.AmazonAWSElasticNetworkAdapter. https://docs.aws.amazon.com/
AWSEC2/latest/UserGuide/enhanced-networking-ena.html
[7] 2023. AWSDedicatedHost. https://docs.aws.amazon.com/AWSEC2/latest/
UserGuide/dedicated-instance.html
[8] 2023. AzureDedicatedHost. https://azure.microsoft.com/en-us/products/
virtual-machines/dedicated-host
[9] MatteoAquilina,EricBBudish,andPeterOâ€™Neill.2020.Quantifyingthehigh-
frequencytrading"armsrace":Asimplenewmethodologyandestimates.Techni-
calReport.WorkingPaper.
[10] BrianNigito.2020.MulticastandtheMarkets. https://signalsandthreads.com/
multicast-and-the-markets/
[11] EricBudish,PeterCramton,andJohnShim.2015.Thehigh-frequencytrading
armsrace:Frequentbatchauctionsasamarketdesignresponse.TheQuarterly
JournalofEconomics130,4(2015),1547â€“1621.
[12] DanielFirestone,AndrewPutnam,SambhramaMundkur,DerekChiou,Alireza
Dabagh,MikeAndrewartha,HariAngepat,VivekBhanu,AdrianCaulfield,Eric
Chung,etal.2018.Azureacceleratednetworking:Smartnicsinthepubliccloud.
In15thUSENIXSymposiumonNetworkedSystemsDesignandImplementation
(NSDI18).51â€“66.
[13] AhmadGhalayini,JinkunGeng,VighneshSachidananda,VinaySriram,Yilong
Geng,BalajiPrabhakar,MendelRosenblum,andAnirudhSivaraman.2021.
CloudEx:afair-accessfinancialexchangeinthecloud.InHotOSâ€™21:Work-
shoponHotTopicsinOperatingSystems,AnnArbor,Michigan,USA,June,1-3,
2021,SebastianAngel,BarisKasikci,andEddieKohler(Eds.).ACM,96â€“103.
https://doi.org/10.1145/3458336.3465278
[14] PiotrJGmytrasiewiczandEdmundHDurfee.1992.Decision-theoreticrecursive
modelingandthecoordinatedattackproblem.InArtificialIntelligencePlanning
Systems.Elsevier,88â€“95.
[15] LeslieLamport.2019.Time,clocks,andtheorderingofeventsinadistributed
system.InConcurrency:theWorksofLeslieLamport,DahliaMalkhi(Ed.).ACM,
179â€“196. https://doi.org/10.1145/3335772.3335934
[16] Yuliang Li, Gautam Kumar, Hema Hariharan, Hassan M. G. Wassel, Peter
Hochschild,DavePlatt,SimonL.Sabato,MinlanYu,NanditaDukkipati,Prashant
Chandra,andAminVahdat.2020.Sundial:Fault-tolerantClockSynchronization
forDatacenters.In14thUSENIXSymposiumonOperatingSystemsDesignand
Implementation,OSDI2020,VirtualEvent,November4-6,2020.USENIXAs-
sociation,1171â€“1186. https://www.usenix.org/conference/osdi20/presentation/
li-yuliang
[17] JenniferLundeliusandNancyA.Lynch.1984.AnUpperandLowerBoundfor
ClockSynchronization.Inf.Control.62,2/3(1984),190â€“204. https://doi.org/10.
1016/S0019-9958(84)80033-9
[18] DonaldMacKenzie.2019.HowFragileIsCompetitioninHigh-FrequencyTrading.
Tabbforum,March26(2019).
[19] VasiliosMavroudisandHaydenMelton.2019.Libra:FairOrder-Matchingfor
ElectronicFinancialExchanges.InProceedingsofthe1stACMConferenceon
AdvancesinFinancialTechnologies,AFT2019,Zurich,Switzerland,October
21-23,2019.ACM,156â€“168. https://doi.org/10.1145/3318041.3355468
[20] RadhikaMittal,VinhTheLam,NanditaDukkipati,EmilyR.Blem,HassanM.G.
Wassel,MoniaGhobadi,AminVahdat,YaogongWang,DavidWetherall,and
DavidZats.2015.TIMELY:RTT-basedCongestionControlfortheDatacenter.
InProceedingsofthe2015ACMConferenceonSpecialInterestGrouponData
Communication,SIGCOMM2015,London,UnitedKingdom,August17-21,2015,
SteveUhlig,OlafMaennel,BradKarp,andJitendraPadhye(Eds.).ACM,537â€“
550. https://doi.org/10.1145/2785956.2787510
[21] NASDAQ. 2021. Nasdaq and AWS Partner to Transform
Capital Markets. https://www.nasdaq.com/press-release/
nasdaq-and-aws-partner-to-transform-capital-markets-2021-12-01
[22] POSTTRADE. 2021. CME and Nasdaq move their mar-
kets to the cloud. https://posttrade360.com/news/technology/
cme-and-nasdaq-move-their-markets-to-the-cloud/
562

ACMSIGCOMMâ€™23,September10,2023,NewYork,NY,USA E.Guptaetal.
with higher response time, the delivery clock at the time of sub-
missionwilleitherreadğ‘‚(ğ‘—,ğ‘)=ğ·ğ¶(ğ‘—,ğ‘))=âŸ¨ğ‘™ğ‘‘(ğ‘–,ğ‘)),ğ‘…ğ‘‡(ğ‘—,ğ‘)+
ğ‘…ğµ_ğ‘€ğ‘ƒ_ğ¿(ğ‘—,ğ‘¥,ğ‘)âŸ© (if (ğ‘—,ğ‘) wassubmittedbeforethenextbatch,
i.e.,ğ‘†Ë†(ğ‘—,ğ‘) <ğ·Ë†(ğ‘—,ğ‘™ğ‘‘(ğ‘–,ğ‘)+1))orğ·ğ¶(ğ‘—,ğ‘) = âŸ¨ğ‘¦,ğ‘†Ë†(ğ‘—,ğ‘)âˆ’ğ·Ë†(ğ‘—,ğ‘¦)âŸ©
Figure14:ProofofLemma2. withğ‘¦ >ğ‘™ğ‘‘(ğ‘–,ğ‘).
Appendicesaresupportingmaterialthathasnotbeenpeer-reviewed. C3impliesthat,ğ‘…ğ‘‡(ğ‘–,ğ‘) <ğ‘…ğ‘‡(ğ‘—,ğ‘)âˆ’(ğµ â„(ğ‘–)âˆ’ğµ ğ‘™(ğ‘—))andğµ ğ‘™(ğ‘–) â‰¤
A ProofofLemma2
ğ‘…ğµ_ğ‘€ğ‘ƒ_ğ¿(ğ‘–,ğ‘¥,ğ‘) â‰¤ğµ â„(ğ‘–),ğµ ğ‘™(ğ‘—) â‰¤ğ‘…ğµ_ğ‘€ğ‘ƒ_ğ¿(ğ‘—,ğ‘¥,ğ‘) â‰¤ğµ â„(ğ‘—).As
aresult,ğ‘…ğ‘‡(ğ‘–,ğ‘)+ğ‘…ğµ_ğ‘€ğ‘ƒ_ğ¿(ğ‘–,ğ‘¥,ğ‘) <ğ‘…ğ‘‡(ğ‘—,ğ‘)+ğ‘…ğµ_ğ‘€ğ‘ƒ_ğ¿(ğ‘—,ğ‘¥,ğ‘)
Thelemmastatesthatforresponsetimefairness,theinter-delivery Asaresult,inboththecases,ğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘—,ğ‘).Henceproved. â–¡
timesshouldbethesameacrossallMPs.
PROOF. Toprovethatthelemmaconditionisnecessarywewill D ImpactofLosses
showthatifthisconditionisnotmetthennosystemexistswhich
Impactofmarketdatapointsbeinglost:Likestatus-quoweadvo-
canachieveresponsetimefairnessforarbitrarytradeorders.
catemarketparticipantsrequestinganydroppedmarketdatapoints
Considerthefollowingscenario(Figure14)wherethelemma
separately.Theretransmittedmarketdatapointdoesnotupdatethe
conditionisnotmet.Letğ·(ğ‘–,ğ‘¥ +1)âˆ’ğ·(ğ‘–,ğ‘¥) =ğ‘1,ğ·(ğ‘—,ğ‘¥ +1)âˆ’
deliveryclockatthereleasebuffer.Thisway,onlytradesgenerated
ğ·(ğ‘—,ğ‘¥)=ğ‘2.Withoutlossofgeneralityweassumeğ‘1<ğ‘2.
usingtheretransmitteddatapointsgetaffected.However,fairness
Considerhypotheticaltrades(ğ‘–,ğ‘)and(ğ‘—,ğ‘)s.t.ğ‘†(ğ‘–,ğ‘)=ğ·(ğ‘–,ğ‘¥+
forallothertradesremainsunaffected.Thelatencyofthesystem
1)+ğ‘3andğ‘†(ğ‘—,ğ‘)=ğ·(ğ‘—,ğ‘¥+1)+ğ‘4.Further,wecanpickğ‘†(ğ‘–,ğ‘)and
cangetaffectedasthedeliveryclockoftheparticipantexperiencing
ğ‘†(ğ‘—,ğ‘)s.t.ğ‘3>ğ‘4andğ‘1+ğ‘3<ğ‘2+ğ‘4.Nowweconsidertwosce-
losseslagstransientlyuntilthenextdatapointisdelivered.Ifdata
nariosforhowthesetradesweregenerated.Thesetwoscenariosare
pointsaregeneratedinfrequently,thenthedeliveryclockofthepar-
indistinguishablefromthecloudprovider/exchangeâ€™sperspective.
ticipantmighttakealargetimetorecover.Topreventthisexplicitly,
Case1:ğ‘‡ğ‘ƒ(ğ‘–,ğ‘)=ğ‘‡ğ‘ƒ(ğ‘—,ğ‘)=ğ‘¥+1.Here,
weadvocateCESsendingperiodicheartbeats.However,webelieve
ğ‘†(ğ‘–,ğ‘)âˆ’ğ·(ğ‘–,ğ‘¥+1)=ğ‘3,ğ‘†(ğ‘—,ğ‘)âˆ’ğ·(ğ‘—,ğ‘¥+1)=ğ‘4. (12) thatmajorexchangesalreadygeneratedataataveryhighfrequency
Sinceğ‘3>ğ‘4,conditionğ¶1impliesthat,ğ‘‚(ğ‘–,ğ‘) >ğ‘‚(ğ‘—,ğ‘).
(adatapointevery20ğœ‡ğ‘ )andsuchheartbeatsarenotnecessary.
Case2:ğ‘‡ğ‘ƒ(ğ‘–,ğ‘)=ğ‘‡ğ‘ƒ(ğ‘—,ğ‘)=ğ‘¥.Here, Impactoftradesbeinglost:Intheeventatradeislost,thepar-
ticipant can retransmit the trade. The retransmitted trade will be
ğ‘†(ğ‘–,ğ‘)âˆ’ğ·(ğ‘–,ğ‘¥)=ğ‘1+ğ‘3,ğ‘†(ğ‘—,ğ‘)âˆ’ğ·(ğ‘—,ğ‘¥)=ğ‘2+ğ‘4. (13)
taggedbythedeliveryclockatthetimeoftheretransmission.Such
In this case, sinceğ‘1+ğ‘3 < ğ‘2+ğ‘4, for response time fairness aretransmittedtradewillincurunfairness.However,fairnessofall
theorderingmustinsteadsatisfytheopposite,ğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘—,ğ‘).A othertradesremainsunaffected.
contradiction!Thus,nosystemcanachieveresponsetimefairness Impact of heartbeats being lost: Lost hearbeats do not impact
inboththesescenarios. â–¡ fairness. However, if a heartbeat is lost then the OB might have
towaitanadditionaltime(forthenextheartbeattoarrive)before
B ProofofCorollary1
forwardingthetradestotheCESincreasinglatency(Equation8).
PROOF. The proof is identical to that of Lemma 2. The only
E Thwartingfront-runningattacks
differencebeing,weconsidertrades(ğ‘–,ğ‘),(ğ‘—,ğ‘)andtriggerpointğ‘¥
andğ‘¥+1,s.t.,ğ‘1+ğ‘3islessthanğ›¿. â–¡ We impose two simple constraints on communication to prevent
frontrunning.(1)Aparticipantmachineanditshelpermachines
C ProofofTheorem4 cancommunicatewitheachotherfreelybuttheycannotcommu-
PROOF. TotheprovethistheoremwewillshowthatwithDBO nicatewithanyothermachinesinthecloud.Thisrestrictioncan
theorderingoftrades(ğ‘–,ğ‘)and(ğ‘—,ğ‘)thatmeettheTheoremcondi- beimposedeasilybycloudproviderstodayusingsecuritygroups.
tionisğ‘‚(ğ‘–,ğ‘) <ğ‘‚(ğ‘—,ğ‘). Thisrestrictionensuresthataparticipantmachinecannotgetmarket
Consider a trade (ğ‘–,ğ‘) with response time less thanğ›¿ âˆ’ğµ â„(ğ‘–). datafromotherparticipantmachinesintheclouddirectly.Next,we
Letğ·Ë†(ğ‘–,ğ‘¥)representthedeliverytimeofğ‘¥ attheRB.Theobserved willensurethataparticipantmachinecannotgetanearliermarket
submissiontimeatRB(ğ‘†Ë†(ğ‘–,ğ‘))forsuchatradewillbe, datafeedfromoutsidethecloud.Wewilldosobyrestrictingthata
participantcanonlysenddatapointğ‘¥ outofthecloud,whenğ‘¥ has
ğ‘†Ë†(ğ‘–,ğ‘)=ğ·Ë†(ğ‘–,ğ‘¥)+ğ‘…ğ‘‡(ğ‘–,ğ‘)+ğ‘…ğµ_ğ‘€ğ‘ƒ_ğ¿(ğ‘–,ğ‘¥,ğ‘). (14)
beendeliveredtoallparticipantsinthecloud.Thisway,marketdata
where ğ‘…ğµ_ğ‘€ğ‘ƒ_ğ¿(ğ‘–,ğ‘¥,ğ‘) represents the combined network round pointscanonlybeavailableoutsidethecloudoncetheyhavebeen
trip latency between RBğ‘– and ğ‘€ğ‘ƒ ğ‘– for trigger point ğ‘¥ and trade deliveredtoalltheparticipants.(2)Thehelpermachinescannotsend
(ğ‘–,ğ‘) .Becauseğ‘…ğµ_ğ‘€ğ‘ƒ_ğ¿(ğ‘–,ğ‘¥,ğ‘) isboundedbyğµ â„(ğ‘–),ğ‘…ğ‘‡(ğ‘–,ğ‘)+ dataoutsidethecloud.Anydata(excludingthetradeorders)from
ğ‘…ğµ_ğ‘€ğ‘ƒ_ğ¿(ğ‘–,ğ‘¥,ğ‘) <ğ›¿orğ‘†Ë†(ğ‘–,ğ‘) <ğ·Ë†(ğ‘–,ğ‘¥)+ğ›¿. aparticipantbeingsentoutsidethecloudistaggedbythedelivery
Recall,consecutivebatchesareatleastseparatedbyğ›¿.Thismeans clockattheRBandbufferedatagateway.Thedatasentbythepar-
that the trigger point (ğ‘¥ = ğ‘‡ğ‘ƒ(ğ‘–,ğ‘)) must be within the last re- ticipantcouldpotentiallybeamarketdatapointwithidlessthanor
ceivedbatch.Thepointğ‘™ğ‘‘(ğ‘–,ğ‘)isalsothelastpointinthisbatchand equaltothelastpointid(firsttuple)ofthedeliveryclocktimestamp.
ğ·Ë†(ğ‘–,ğ‘™ğ‘‘(ğ‘–,ğ‘)) =ğ·Ë†(ğ‘–,ğ‘¥).Thedeliveryclockfortrade(ğ‘–,ğ‘)willthus Thegatewaythusbuffersthisdatauntilitissurethatthealldata
be:ğ‘‚(ğ‘–,ğ‘)=ğ·ğ¶(ğ‘–,ğ‘)=âŸ¨ğ‘™ğ‘‘(ğ‘–,ğ‘),ğ‘…ğ‘‡(ğ‘–,ğ‘)+ğ‘…ğµ_ğ‘€ğ‘ƒ_ğ¿(ğ‘–,ğ‘¥,ğ‘)âŸ©. pointswithidlessthanthelastdatapointidinthedeliveryclock
Withbatching,forparticipantğ‘—,ğ‘¥ andğ‘™ğ‘‘(ğ‘–,ğ‘)alsobelongtothe timestamphavebeendelivered.Forthispurpose,RBâ€™speriodically
same batch ğ·Ë†(ğ‘—,ğ‘™ğ‘‘(ğ‘–,ğ‘)) = ğ·Ë†(ğ‘—,ğ‘¥). For a competing trade (ğ‘—,ğ‘) communicatetheirdeliveryclocktothegateway.
563

